<!DOCTYPE html>
<html lang="pt-BR">
<!--
    ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
    ‚ïë                     FICHA DE RPG - DRAUNIA                           ‚ïë
    ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
    ‚ïë  √çNDICE DO DOCUMENTO                                                 ‚ïë
    ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
    ‚ïë                                                                      ‚ïë
    ‚ïë  MODALS (Sobreposi√ß√µes) #region linha 63                             ‚ïë
    ‚ïë    64   - Login/Register Modal                                       ‚ïë
    ‚ïë    104  - Character Select Modal                                     ‚ïë
    ‚ïë    123  - System Select Modal                                        ‚ïë
    ‚ïë    142  - System Editor Modal (legado)                               ‚ïë
    ‚ïë    876  - Systems Manager Modal                                      ‚ïë
    ‚ïë                                                                      ‚ïë
    ‚ïë  TELAS PRINCIPAIS #region linha 898                                  ‚ïë
    ‚ïë    941  - TELA PRINCIPAL (atributos, recursos)                       ‚ïë
    ‚ïë    1331 - TELA DE COMBATE (ataques, CA)                              ‚ïë
    ‚ïë    1496 - TELA DE PER√çCIAS E FUS√ïES                                  ‚ïë
    ‚ïë    1676 - TELA DE HIST√ìRIA (background)                              ‚ïë
    ‚ïë                                                                      ‚ïë
    ‚ïë  SYSTEM EDITOR FULL-SCREEN #region linha 1758                        ‚ïë
    ‚ïë    1840 - Main Content Area                                          ‚ïë
    ‚ïë    (Pain√©is: Vis√£o Geral, Informa√ß√µes, Atributos, Recursos,         ‚ïë
    ‚ïë     Classes, Ra√ßas, Per√≠cias, Combate, Magias, Campos)              ‚ïë
    ‚ïë                                                                      ‚ïë
    ‚ïë  SCRIPTS                                                             ‚ïë
    ‚ïë    2820 - Scripts JavaScript                                         ‚ïë
    ‚ïë                                                                      ‚ïë
    ‚ïë  COMPONENTES SEPARADOS (em /components/)                             ‚ïë
    ‚ïë    components/system-editor.html - Backup do editor de sistemas      ‚ïë
    ‚ïë                                                                      ‚ïë
    ‚ïë  Use #region para navegar/colapsar se√ß√µes no VS Code                 ‚ïë
    ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0d0d15">
    <title>Ficha de RPG - Draunia</title>
    <link rel="stylesheet" href="css/style.css?v=6">
    <link rel="stylesheet" href="css/sheet-layout.css?v=1">
    <link rel="stylesheet" href="css/system-editor-base.css">
    <link rel="stylesheet" href="css/system-editor-forms.css">
    <link rel="stylesheet" href="css/system-editor-mobile.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body>
    <!-- #region MODAIS DE AUTENTICA√á√ÉO E SELE√á√ÉO -->
    <!-- Login/Register Modal -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">Entrar</button>
                <button class="auth-tab" data-tab="register">Cadastrar</button>
            </div>
            
            <form id="loginForm" class="auth-form">
                <h2>Bem-vindo a Draunia!</h2>
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Senha</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn-primary">Entrar</button>
            </form>
            
            <form id="registerForm" class="auth-form hidden">
                <h2>Criar Conta</h2>
                <div class="form-group">
                    <label for="registerName">Nome</label>
                    <input type="text" id="registerName" required>
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">Senha</label>
                    <input type="password" id="registerPassword" required minlength="6">
                </div>
                <button type="submit" class="btn-primary">Cadastrar</button>
            </form>
        </div>
    </div>

    <!-- Character Select Modal -->
    <div id="characterModal" class="modal hidden">
        <div class="modal-content">
            <h2>Suas Fichas</h2>
            <div id="characterList" class="character-list"></div>
            <div class="modal-buttons-row">
                <button id="newCharacterBtn" class="btn-primary">
                    <i class="fas fa-plus"></i> Nova Ficha
                </button>
                <button id="manageSysBtn" class="btn-secondary" onclick="console.log('Clique direto!'); SystemManager.showManager();">
                    <i class="fas fa-cogs"></i> Gerenciar Sistemas
                </button>
            </div>
            <button id="logoutBtn" class="btn-secondary">
                <i class="fas fa-sign-out-alt"></i> Sair
            </button>
        </div>
    </div>

    <!-- System Select Modal -->
    <div id="systemSelectModal" class="modal hidden">
        <div class="modal-content system-select-content">
            <h2><i class="fas fa-dice-d20"></i> Escolha o Sistema</h2>
            <p class="system-description">Selecione o sistema de regras para sua nova ficha:</p>
            <div id="systemOptionsList" class="system-options">
                <!-- Systems will be generated by JS -->
            </div>
            <div class="modal-buttons-row">
                <button class="btn-secondary" onclick="App.cancelSystemSelect()">
                    <i class="fas fa-arrow-left"></i> Voltar
                </button>
                <button class="btn-primary" onclick="App.showSystemEditor()">
                    <i class="fas fa-plus"></i> Criar Novo Sistema
                </button>
            </div>
        </div>
    </div>

    <!-- System Editor Modal -->
    <div id="systemEditorModal" class="modal hidden">
        <div class="modal-content system-editor-content">
            <div class="system-editor-header">
                <h2><i class="fas fa-cogs"></i> <span id="systemEditorTitle">Criar Novo Sistema</span></h2>
                <button class="btn-close" onclick="SystemManager.closeEditor()"><i class="fas fa-times"></i></button>
            </div>
            
            <div class="system-editor-body">
                <!-- Nome do Sistema -->
                <div class="system-section">
                    <h3><i class="fas fa-tag"></i> Informa√ß√µes B√°sicas</h3>
                    <div class="form-group">
                        <label for="systemName">Nome do Sistema *</label>
                        <input type="text" id="systemName" placeholder="Ex: Meu Sistema Personalizado" required>
                    </div>
                    <div class="form-group">
                        <label for="systemDescription">Descri√ß√£o</label>
                        <textarea id="systemDescription" placeholder="Descri√ß√£o breve do sistema..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="systemIcon">√çcone</label>
                        <select id="systemIcon">
                            <option value="fa-dice-d20">üé≤ Dado D20</option>
                            <option value="fa-scroll">üìú Pergaminho</option>
                            <option value="fa-dragon">üêâ Drag√£o</option>
                            <option value="fa-hat-wizard">üßô Mago</option>
                            <option value="fa-shield-alt">üõ°Ô∏è Escudo</option>
                            <option value="fa-sword">‚öîÔ∏è Espada</option>
                            <option value="fa-skull">üíÄ Caveira</option>
                            <option value="fa-star">‚≠ê Estrela</option>
                        </select>
                    </div>
                </div>

                <!-- Atributos -->
                <div class="system-section">
                    <h3><i class="fas fa-fist-raised"></i> Atributos</h3>
                    <div class="toggle-group">
                        <label class="toggle-label">
                            <span>Tipo de Atributos</span>
                            <select id="attrType">
                                <option value="realsscripts">Realms&Scripts (FOR, CON, VON, CAR, INT, AGI)</option>
                                <option value="dnd">D&D Cl√°ssico (FOR, DES, CON, INT, SAB, CAR)</option>
                                <option value="custom">Personalizado</option>
                            </select>
                        </label>
                    </div>
                    <div id="customAttrsSection" class="custom-attrs-section hidden">
                        <div class="form-group">
                            <label>Atributos Personalizados (separados por v√≠rgula)</label>
                            <input type="text" id="customAttrs" placeholder="Ex: FOR, DES, CON, INT, SAB, CAR">
                            <small class="form-hint">Use siglas de 3 letras mai√∫sculas</small>
                        </div>
                    </div>
                    <div class="toggle-group">
                        <label class="toggle-label">
                            <span>Limite de Pontos de Atributo</span>
                            <input type="number" id="attrPointLimit" value="8" min="0">
                        </label>
                        <small class="form-hint">0 = sem limite (distribui√ß√£o livre)</small>
                    </div>
                    <div class="toggle-group">
                        <label class="toggle-label">
                            <span>C√°lculo de Modificador</span>
                            <select id="modifierCalc">
                                <option value="direct">Direto (valor = modificador)</option>
                                <option value="dnd">D&D ((valor - 10) / 2, arredonda para baixo)</option>
                                <option value="half">Metade (valor / 2)</option>
                                <option value="minus5">Subtra√ß√£o (valor - 5)</option>
                            </select>
                        </label>
                    </div>
                    <div class="toggle-group">
                        <label class="toggle-label">
                            <span>Valor M√≠nimo de Atributo</span>
                            <input type="number" id="attrMinValue" value="1" min="0">
                        </label>
                    </div>
                    <div class="toggle-group">
                        <label class="toggle-label">
                            <span>Valor M√°ximo de Atributo</span>
                            <input type="number" id="attrMaxValue" value="20" min="1">
                        </label>
                    </div>
                </div>

                <!-- Pontos de Vida -->
                <div class="system-section">
                    <h3><i class="fas fa-heart"></i> Pontos de Vida (HP)</h3>
                    <div class="toggle-group">
                        <label class="toggle-label">
                            <span>F√≥rmula de HP M√°ximo</span>
                            <select id="hpFormula">
                                <option value="realsscripts">Realms&Scripts: (Cora√ß√£o √ó 20) + (N√≠vel √ó CON)</option>
                                <option value="dnd">D&D: Dado de Vida + mod. CON por n√≠vel</option>
                                <option value="levelcon">N√≠vel √ó CON</option>
                                <option value="levelonly">Apenas N√≠vel √ó Multiplicador</option>
                                <option value="flat">Fixo por N√≠vel</option>
                                <option value="custom">Personalizado</option>
                            </select>
                        </label>
                    </div>
                    <div id="customHpSection" class="custom-formula-section hidden">
                        <div class="form-group">
                            <label>F√≥rmula Personalizada</label>
                            <input type="text" id="customHpFormula" placeholder="Ex: (level * 10) + (con * 2)">
                            <small class="form-hint">Vari√°veis: level, con, for, agi, int, von, car, dex, wis, cha, hitDie</small>
                        </div>
                        <div class="formula-preview" id="hpFormulaPreview"></div>
                    </div>
                    <div id="flatHpSection" class="custom-formula-section hidden">
                        <div class="form-group-row">
                            <div class="form-group">
                                <label>HP Base (N√≠vel 1)</label>
                                <input type="number" id="flatHpBase" value="10" min="1">
                            </div>
                            <div class="form-group">
                                <label>HP por N√≠vel Adicional</label>
                                <input type="number" id="flatHpPerLevel" value="5" min="0">
                            </div>
                        </div>
                        <div class="formula-preview">Ex: N√≠vel 5 = 10 + (4 √ó 5) = <strong>30 HP</strong></div>
                    </div>
                    <div id="levelOnlyHpSection" class="custom-formula-section hidden">
                        <div class="form-group">
                            <label>Multiplicador por N√≠vel</label>
                            <input type="number" id="hpLevelMultiplier" value="10" min="1">
                        </div>
                        <div class="formula-preview">Ex: N√≠vel 5 √ó 10 = <strong>50 HP</strong></div>
                    </div>
                </div>

                <!-- Pontos de Energia -->
                <div class="system-section">
                    <h3><i class="fas fa-bolt"></i> Pontos de Energia (PE/Mana)</h3>
                    <div class="toggle-group">
                        <label class="toggle-switch">
                            <input type="checkbox" id="hasEnergyPoints" checked>
                            <span class="slider"></span>
                        </label>
                        <span>Sistema possui Pontos de Energia</span>
                    </div>
                    <div id="energyPointsConfig">
                        <div class="toggle-group">
                            <label class="toggle-label">
                                <span>Nome dos Pontos</span>
                                <input type="text" id="energyName" value="PE" placeholder="PE, Mana, Ki, Foco...">
                            </label>
                        </div>
                        <div class="toggle-group">
                            <label class="toggle-label">
                                <span>F√≥rmula de PE M√°ximo</span>
                                <select id="peFormula">
                                    <option value="realsscripts">Realms&Scripts: (C√©rebro √ó 6) + (N√≠vel √ó VON)</option>
                                    <option value="simple">Simples: N√≠vel √ó Multiplicador</option>
                                    <option value="attr">Baseado em Atributo</option>
                                    <option value="attrlevel">Atributo + (N√≠vel √ó Mult)</option>
                                    <option value="custom">Personalizado</option>
                                </select>
                            </label>
                        </div>
                        <div id="simplePeSection" class="custom-formula-section hidden">
                            <div class="form-group">
                                <label>Multiplicador por N√≠vel</label>
                                <input type="number" id="peMultiplier" value="5" min="1">
                            </div>
                            <div class="formula-preview">Ex: N√≠vel 5 √ó 5 = <strong>25 PE</strong></div>
                        </div>
                        <div id="attrPeSection" class="custom-formula-section hidden">
                            <div class="form-group-row">
                                <div class="form-group">
                                    <label>Atributo Base</label>
                                    <select id="peAttr">
                                        <option value="int">INT (Intelig√™ncia)</option>
                                        <option value="wis">SAB (Sabedoria)</option>
                                        <option value="cha">CAR (Carisma)</option>
                                        <option value="von">VON (Vontade)</option>
                                        <option value="con">CON (Constitui√ß√£o)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Multiplicador</label>
                                    <input type="number" id="peAttrMultiplier" value="2" min="1">
                                </div>
                            </div>
                            <div class="formula-preview">Ex: INT 14 √ó 2 = <strong>28 PE</strong></div>
                        </div>
                        <div id="attrLevelPeSection" class="custom-formula-section hidden">
                            <div class="form-group-row">
                                <div class="form-group">
                                    <label>Atributo Base</label>
                                    <select id="peLevelAttr">
                                        <option value="int">INT</option>
                                        <option value="wis">SAB</option>
                                        <option value="cha">CAR</option>
                                        <option value="von">VON</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Mult. Atributo</label>
                                    <input type="number" id="peLevelAttrMultiplier" value="1" min="1">
                                </div>
                                <div class="form-group">
                                    <label>Mult. N√≠vel</label>
                                    <input type="number" id="peLevelMultiplier" value="3" min="1">
                                </div>
                            </div>
                            <div class="formula-preview">Ex: (INT 14 √ó 1) + (N√≠vel 5 √ó 3) = <strong>29 PE</strong></div>
                        </div>
                        <div id="customPeSection" class="custom-formula-section hidden">
                            <div class="form-group">
                                <label>F√≥rmula Personalizada</label>
                                <input type="text" id="customPeFormula" placeholder="Ex: (level * 5) + (int * 2)">
                                <small class="form-hint">Vari√°veis: level, int, wis, cha, von, con</small>
                            </div>
                        </div>
                        <div class="toggle-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="peRegenPerRest">
                                <span class="slider"></span>
                            </label>
                            <span>Regenera completamente ap√≥s descanso longo</span>
                        </div>
                    </div>
                </div>

                <!-- Sanidade -->
                <div class="system-section">
                    <h3><i class="fas fa-brain"></i> Sanidade</h3>
                    <div class="toggle-group">
                        <label class="toggle-switch">
                            <input type="checkbox" id="hasSanity" checked>
                            <span class="slider"></span>
                        </label>
                        <span>Sistema possui Sanidade</span>
                    </div>
                    <div id="sanityConfig">
                        <div class="toggle-group">
                            <label class="toggle-label">
                                <span>Nome do Recurso</span>
                                <input type="text" id="sanityName" value="Sanidade" placeholder="Sanidade, Stress, Corrup√ß√£o...">
                            </label>
                        </div>
                        <div class="toggle-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="sanityHasMax">
                                <span class="slider"></span>
                            </label>
                            <span>Possui valor m√°ximo calculado</span>
                        </div>
                        <div id="sanityMaxConfig" class="hidden">
                            <div class="toggle-group">
                                <label class="toggle-label">
                                    <span>F√≥rmula de Sanidade M√°xima</span>
                                    <select id="sanityFormula">
                                        <option value="dnd">D&D: SAB √ó 5</option>
                                        <option value="flat">Valor Fixo</option>
                                        <option value="attr">Atributo √ó Multiplicador</option>
                                        <option value="custom">Personalizado</option>
                                    </select>
                                </label>
                            </div>
                            <div id="flatSanitySection" class="custom-formula-section hidden">
                                <div class="form-group">
                                    <label>Sanidade M√°xima Fixa</label>
                                    <input type="number" id="flatSanity" value="100" min="1">
                                </div>
                            </div>
                            <div id="attrSanitySection" class="custom-formula-section hidden">
                                <div class="form-group-row">
                                    <div class="form-group">
                                        <label>Atributo</label>
                                        <select id="sanityAttr">
                                            <option value="wis">SAB</option>
                                            <option value="cha">CAR</option>
                                            <option value="von">VON</option>
                                            <option value="con">CON</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Multiplicador</label>
                                        <input type="number" id="sanityAttrMultiplier" value="5" min="1">
                                    </div>
                                </div>
                            </div>
                            <div id="customSanitySection" class="custom-formula-section hidden">
                                <div class="form-group">
                                    <label>F√≥rmula Personalizada</label>
                                    <input type="text" id="customSanityFormula" placeholder="Ex: (wis * 5) + (level * 2)">
                                </div>
                            </div>
                        </div>
                        <div class="toggle-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="sanityCanGoNegative">
                                <span class="slider"></span>
                            </label>
                            <span>Sanidade pode ficar negativa</span>
                        </div>
                    </div>
                </div>

                <!-- Pontos de A√ß√£o -->
                <div class="system-section">
                    <h3><i class="fas fa-running"></i> Pontos de A√ß√£o (PA)</h3>
                    <div class="toggle-group">
                        <label class="toggle-switch">
                            <input type="checkbox" id="hasActionPoints">
                            <span class="slider"></span>
                        </label>
                        <span>Sistema possui Pontos de A√ß√£o</span>
                    </div>
                    <div id="actionPointsConfig" class="hidden">
                        <div class="toggle-group">
                            <label class="toggle-label">
                                <span>Nome dos Pontos</span>
                                <input type="text" id="paName" value="PA" placeholder="PA, A√ß√µes, AP...">
                            </label>
                        </div>
                        <div class="toggle-group">
                            <label class="toggle-label">
                                <span>F√≥rmula de PA</span>
                                <select id="paFormula">
                                    <option value="realsscripts">Realms&Scripts: AGI + N√≠vel + 4</option>
                                    <option value="flat">Valor Fixo</option>
                                    <option value="attr">Baseado em Atributo</option>
                                    <option value="custom">Personalizado</option>
                                </select>
                            </label>
                        </div>
                        <div id="flatPaSection" class="custom-formula-section hidden">
                            <div class="form-group">
                                <label>PA por Turno</label>
                                <input type="number" id="flatPa" value="3" min="1">
                            </div>
                        </div>
                        <div id="attrPaSection" class="custom-formula-section hidden">
                            <div class="form-group-row">
                                <div class="form-group">
                                    <label>Atributo</label>
                                    <select id="paAttr">
                                        <option value="agi">AGI</option>
                                        <option value="dex">DES</option>
                                        <option value="wis">SAB</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Base</label>
                                    <input type="number" id="paBase" value="4" min="0">
                                </div>
                            </div>
                            <div class="formula-preview">Ex: 4 + AGI 3 = <strong>7 PA</strong></div>
                        </div>
                        <div id="customPaSection" class="custom-formula-section hidden">
                            <div class="form-group">
                                <label>F√≥rmula Personalizada</label>
                                <input type="text" id="customPaFormula" placeholder="Ex: agi + level + 4">
                                <small class="form-hint">Vari√°veis: level, agi, dex, for, con</small>
                            </div>
                        </div>
                        <div class="toggle-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="paAffectedByArmor" checked>
                                <span class="slider"></span>
                            </label>
                            <span>Armadura pesada reduz PA</span>
                        </div>
                    </div>
                </div>

                <!-- Fus√µes -->
                <div class="system-section">
                    <h3><i class="fas fa-dna"></i> Fus√µes</h3>
                    <div class="toggle-group">
                        <label class="toggle-switch">
                            <input type="checkbox" id="hasFusions">
                            <span class="slider"></span>
                        </label>
                        <span>Sistema possui Fus√µes (√ìrg√£os, Ossos, M√∫sculos)</span>
                    </div>
                    <div id="fusionsConfig" class="hidden">
                        <div class="form-group">
                            <label>Tipos de Fus√£o dispon√≠veis (uma por linha: Nome, Efeito)</label>
                            <textarea id="fusionTypes" placeholder="Cora√ß√£o, Aumenta HP&#10;C√©rebro, Aumenta PE&#10;Olhos, Melhora Percep√ß√£o"></textarea>
                            <small class="form-hint">Use Realms&Scripts padr√£o ou personalize</small>
                        </div>
                    </div>
                </div>

                <!-- Combate e Defesas -->
                <div class="system-section">
                    <h3><i class="fas fa-shield-alt"></i> Combate e Defesas</h3>
                    
                    <div class="subsection">
                        <h4>Classe de Armadura (CA)</h4>
                        <div class="toggle-group">
                            <label class="toggle-label">
                                <span>F√≥rmula de CA</span>
                                <select id="caFormula">
                                    <option value="realsscripts">Realms&Scripts: 10 + B√¥nus de Armadura</option>
                                    <option value="dnd">D&D: 10 + mod. DES + Armadura</option>
                                    <option value="flatbase">Base Fixa + mod. Atributo</option>
                                    <option value="custom">Personalizado</option>
                                </select>
                            </label>
                        </div>
                        <div id="flatBaseCaSection" class="custom-formula-section hidden">
                            <div class="form-group-row">
                                <div class="form-group">
                                    <label>CA Base</label>
                                    <input type="number" id="caBase" value="10" min="0">
                                </div>
                                <div class="form-group">
                                    <label>Atributo</label>
                                    <select id="caAttr">
                                        <option value="dex">DES</option>
                                        <option value="agi">AGI</option>
                                        <option value="con">CON</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div id="customCaSection" class="custom-formula-section hidden">
                            <div class="form-group">
                                <label>F√≥rmula Personalizada</label>
                                <input type="text" id="customCaFormula" placeholder="Ex: 10 + dexMod + armorBonus">
                                <small class="form-hint">Vari√°veis: dexMod, armorBonus, shieldBonus, level</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="subsection">
                        <h4>Esquiva</h4>
                        <div class="toggle-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="hasDodge">
                                <span class="slider"></span>
                            </label>
                            <span>Sistema possui Esquiva separada</span>
                        </div>
                        <div id="dodgeConfig" class="hidden">
                            <div class="toggle-group">
                                <label class="toggle-label">
                                    <span>F√≥rmula de Esquiva</span>
                                    <select id="dodgeFormula">
                                        <option value="realsscripts">Realms&Scripts: CA + Reflexos</option>
                                        <option value="dexbased">10 + mod. DES</option>
                                        <option value="custom">Personalizado</option>
                                    </select>
                                </label>
                            </div>
                            <div id="customDodgeSection" class="custom-formula-section hidden">
                                <div class="form-group">
                                    <label>F√≥rmula Personalizada</label>
                                    <input type="text" id="customDodgeFormula" placeholder="Ex: ca + reflexos">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="subsection">
                        <h4>Iniciativa</h4>
                        <div class="toggle-group">
                            <label class="toggle-label">
                                <span>F√≥rmula de Iniciativa</span>
                                <select id="initiativeFormula">
                                    <option value="dex">D&D: mod. DES</option>
                                    <option value="agi">Realms&Scripts: AGI</option>
                                    <option value="skill">Baseado em Per√≠cia</option>
                                    <option value="custom">Personalizado</option>
                                </select>
                            </label>
                        </div>
                        <div id="skillInitSection" class="custom-formula-section hidden">
                            <div class="form-group">
                                <label>Per√≠cia de Iniciativa</label>
                                <input type="text" id="initSkill" value="iniciativa" placeholder="Nome da per√≠cia">
                            </div>
                        </div>
                        <div id="customInitSection" class="custom-formula-section hidden">
                            <div class="form-group">
                                <label>F√≥rmula Personalizada</label>
                                <input type="text" id="customInitFormula" placeholder="Ex: dexMod + profBonus">
                            </div>
                        </div>
                    </div>
                    
                    <div class="subsection">
                        <h4>Testes de Resist√™ncia</h4>
                        <div class="toggle-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="hasSavingThrows">
                                <span class="slider"></span>
                            </label>
                            <span>Sistema possui Testes de Resist√™ncia (Saving Throws)</span>
                        </div>
                        <div id="savingThrowsConfig" class="hidden">
                            <div class="toggle-group">
                                <label class="toggle-label">
                                    <span>Tipo de Resist√™ncia</span>
                                    <select id="savingThrowType">
                                        <option value="dnd">D&D: 6 atributos com profici√™ncia</option>
                                        <option value="three">3 Tipos: Fortitude, Reflexos, Vontade</option>
                                        <option value="custom">Personalizado</option>
                                    </select>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Classes -->
                <div class="system-section">
                    <h3><i class="fas fa-hat-wizard"></i> Classes</h3>
                    <div class="toggle-group">
                        <label class="toggle-switch">
                            <input type="checkbox" id="hasClasses">
                            <span class="slider"></span>
                        </label>
                        <span>Sistema possui Classes</span>
                    </div>
                    <div id="classesConfig" class="hidden">
                        <div class="toggle-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="classAffectsHp" checked>
                                <span class="slider"></span>
                            </label>
                            <span>Classe define Dado de Vida (HP)</span>
                        </div>
                        <div class="toggle-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="classAffectsSpellcasting">
                                <span class="slider"></span>
                            </label>
                            <span>Classe define atributo de conjura√ß√£o</span>
                        </div>
                        <div class="toggle-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="allowMulticlass">
                                <span class="slider"></span>
                            </label>
                            <span>Permite multiclasse</span>
                        </div>
                        <div class="toggle-group">
                            <label class="toggle-label">
                                <span>Lista de Classes</span>
                                <select id="classListType">
                                    <option value="dnd">D&D 5e (12 classes)</option>
                                    <option value="simple">Simples (Guerreiro, Mago, Ladino)</option>
                                    <option value="custom">Personalizado</option>
                                </select>
                            </label>
                        </div>
                        <div id="customClassSection" class="custom-formula-section hidden">
                            <div class="form-group">
                                <label>Classes (uma por linha: Nome, DadoVida, AtributoMagia)</label>
                                <textarea id="classList" placeholder="Guerreiro, d10, -&#10;Mago, d6, INT&#10;Cl√©rigo, d8, SAB&#10;Ladino, d8, -"></textarea>
                                <small class="form-hint">Use "-" para classes sem magia</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Per√≠cias -->
                <div class="system-section">
                    <h3><i class="fas fa-star"></i> Per√≠cias</h3>
                    <div class="toggle-group">
                        <label class="toggle-label">
                            <span>Sistema de Per√≠cias</span>
                            <select id="skillSystem">
                                <option value="realsscripts">Realms&Scripts (N√≠veis: Treinada, Veterana, Expert)</option>
                                <option value="dnd">D&D (Profici√™ncia + Expertise)</option>
                                <option value="ranks">Ranks Livres (pontos por n√≠vel)</option>
                                <option value="simple">Simples (apenas proficiente ou n√£o)</option>
                            </select>
                        </label>
                    </div>
                    <div id="ranksConfig" class="custom-formula-section hidden">
                        <div class="form-group-row">
                            <div class="form-group">
                                <label>Pontos por N√≠vel</label>
                                <input type="number" id="skillPointsPerLevel" value="4" min="1">
                            </div>
                            <div class="form-group">
                                <label>+ Atributo</label>
                                <select id="skillPointsAttr">
                                    <option value="int">INT</option>
                                    <option value="wis">SAB</option>
                                    <option value="none">Nenhum</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="toggle-group">
                        <label class="toggle-label">
                            <span>Lista de Per√≠cias</span>
                            <select id="skillList">
                                <option value="realsscripts">Realms&Scripts (28 per√≠cias)</option>
                                <option value="dnd">D&D 5e (18 per√≠cias)</option>
                                <option value="minimal">M√≠nima (6 per√≠cias b√°sicas)</option>
                                <option value="custom">Personalizado</option>
                            </select>
                        </label>
                    </div>
                    <div id="customSkillSection" class="custom-formula-section hidden">
                        <div class="form-group">
                            <label>Per√≠cias (uma por linha: Nome, Atributo)</label>
                            <textarea id="customSkillList" placeholder="Atletismo, FOR&#10;Furtividade, DES&#10;Arcanismo, INT&#10;Percep√ß√£o, SAB&#10;Persuas√£o, CAR"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Sistema de Magia -->
                <div class="system-section">
                    <h3><i class="fas fa-magic"></i> Sistema de Magia</h3>
                    <div class="toggle-group">
                        <label class="toggle-switch">
                            <input type="checkbox" id="hasSpellSlots">
                            <span class="slider"></span>
                        </label>
                        <span>Sistema possui Espa√ßos de Magia (Spell Slots)</span>
                    </div>
                    <div id="spellSlotsConfig" class="hidden">
                        <div class="toggle-group">
                            <label class="toggle-label">
                                <span>Tipo de Sistema de Magia</span>
                                <select id="spellSlotSystem">
                                    <option value="dnd">D&D 5e (Spell Slots por n√≠vel)</option>
                                    <option value="points">Pontos de Magia (usa PE)</option>
                                    <option value="perday">Magias por Dia</option>
                                    <option value="custom">Personalizado</option>
                                </select>
                            </label>
                        </div>
                        <div class="toggle-group">
                            <label class="toggle-label">
                                <span>N√≠vel m√°ximo de magia</span>
                                <select id="maxSpellLevel">
                                    <option value="9">9¬∫ C√≠rculo (D&D padr√£o)</option>
                                    <option value="6">6¬∫ C√≠rculo</option>
                                    <option value="5">5¬∫ C√≠rculo</option>
                                    <option value="3">3¬∫ C√≠rculo</option>
                                </select>
                            </label>
                        </div>
                        <div class="toggle-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="hasCantrips" checked>
                                <span class="slider"></span>
                            </label>
                            <span>Possui Truques/Cantrips (magias sem custo)</span>
                        </div>
                        <div class="toggle-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="hasRituals">
                                <span class="slider"></span>
                            </label>
                            <span>Possui sistema de Rituais</span>
                        </div>
                    </div>
                </div>

                <!-- Op√ß√µes Avan√ßadas -->
                <div class="system-section collapsible">
                    <h3 class="section-toggle"><i class="fas fa-cog"></i> Op√ß√µes Avan√ßadas <i class="fas fa-chevron-down"></i></h3>
                    <div class="section-content hidden">
                        <div class="toggle-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="hasEncumbrance">
                                <span class="slider"></span>
                            </label>
                            <span>Sistema de carga/peso</span>
                        </div>
                        <div class="toggle-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="hasAdvantage">
                                <span class="slider"></span>
                            </label>
                            <span>Vantagem/Desvantagem nos dados</span>
                        </div>
                        <div class="toggle-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="hasInspiration">
                                <span class="slider"></span>
                            </label>
                            <span>Sistema de Inspira√ß√£o</span>
                        </div>
                        <div class="toggle-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="hasDeathSaves">
                                <span class="slider"></span>
                            </label>
                            <span>Testes de Morte (Death Saves)</span>
                        </div>
                        <div class="toggle-group">
                            <label class="toggle-label">
                                <span>Descanso Curto restaura</span>
                                <select id="shortRestRestore">
                                    <option value="hitdice">Dados de Vida (D&D)</option>
                                    <option value="partial">Parte do HP</option>
                                    <option value="none">Nada</option>
                                </select>
                            </label>
                        </div>
                        <div class="toggle-group">
                            <label class="toggle-label">
                                <span>Descanso Longo restaura</span>
                                <select id="longRestRestore">
                                    <option value="full">HP e recursos completos</option>
                                    <option value="hp">Apenas HP</option>
                                    <option value="partial">Parte dos recursos</option>
                                </select>
                            </label>
                        </div>
                    </div>
                </div>

            </div>
            
            <div class="system-editor-footer">
                <button class="btn-secondary" onclick="SystemManager.closeEditor()">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button class="btn-danger hidden" id="deleteSystemBtn" onclick="SystemManager.deleteSystem()">
                    <i class="fas fa-trash"></i> Excluir Sistema
                </button>
                <button class="btn-primary" onclick="SystemManager.saveSystem()">
                    <i class="fas fa-save"></i> Salvar Sistema
                </button>
            </div>
        </div>
    </div>

    <!-- Systems Manager Modal -->
    <div id="systemsManagerModal" class="modal hidden">
        <div class="modal-content systems-manager-content">
            <h2><i class="fas fa-cogs"></i> Gerenciar Sistemas</h2>
            <p class="system-description">Crie e edite sistemas de regras personalizados. Sistemas s√£o privados e vinculados √† sua conta.</p>
            
            <div id="systemsManagerList" class="systems-list">
                <!-- Systems will be generated by JS -->
            </div>
            
            <div class="modal-buttons-row">
                <button class="btn-secondary" onclick="SystemManager.backToCharacters()">
                    <i class="fas fa-arrow-left"></i> Voltar
                </button>
                <button class="btn-primary" onclick="SystemManager.createNew()">
                    <i class="fas fa-plus"></i> Criar Novo Sistema
                </button>
            </div>
        </div>
    </div>

    <!-- Share System Modal -->
    <div id="shareSystemModal" class="modal hidden">
        <div class="modal-content share-system-content">
            <h2><i class="fas fa-share-alt"></i> Compartilhar Sistema</h2>
            <p class="system-description">
                Compartilhe "<strong id="shareSystemName"></strong>" com outro usu√°rio.
                Uma c√≥pia do sistema ser√° enviada para a conta do destinat√°rio.
            </p>
            
            <div class="form-group">
                <label for="shareEmailInput">Email do Destinat√°rio</label>
                <input type="email" id="shareEmailInput" placeholder="email@exemplo.com" required>
                <small class="form-hint">O usu√°rio deve ter uma conta cadastrada no sistema.</small>
            </div>
            
            <div class="modal-buttons-row">
                <button class="btn-secondary" onclick="SystemManager.closeShareModal()">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button class="btn-primary" onclick="SystemManager.shareSystem()">
                    <i class="fas fa-paper-plane"></i> Enviar
                </button>
            </div>
        </div>
    </div>

    <!-- Template Picker Modal -->
    <div id="templatePickerModal" class="modal">
        <div class="modal-content template-picker-content">
            <button class="modal-close" onclick="SystemEditor.closeTemplatePicker()">
                <i class="fas fa-times"></i>
            </button>
            <h2><i class="fas fa-wand-magic-sparkles"></i> Escolha um Template</h2>
            <p class="modal-subtitle">Selecione um modelo para come√ßar rapidamente ou comece do zero.</p>
            
            <div class="template-grid">
                <!-- Templates will be generated by JavaScript -->
            </div>
            
            <div class="modal-footer">
                <button class="btn-secondary" onclick="SystemEditor.closeTemplatePicker()">
                    <i class="fas fa-times"></i> Cancelar
                </button>
            </div>
        </div>
    </div>
    <!-- #endregion MODAIS DE AUTENTICA√á√ÉO E SELE√á√ÉO -->

    <!-- #region CONTE√öDO PRINCIPAL (FICHA) -->
    <!-- Main Content -->
    <div id="mainContent" class="hidden">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1><i class="fas fa-scroll"></i> Draunia</h1>
            </div>
            <div class="header-center">
                <!-- Navigation Tabs -->
                <nav class="main-nav">
                    <button class="nav-tab active" data-tab="principal">
                        <i class="fas fa-user"></i>
                        <span>Principal</span>
                    </button>
                    <button class="nav-tab" data-tab="combate">
                        <i class="fas fa-fist-raised"></i>
                        <span>Combate</span>
                    </button>
                    <button class="nav-tab" data-tab="pericias">
                        <i class="fas fa-star"></i>
                        <span>Per√≠cias</span>
                    </button>
                    <button class="nav-tab" data-tab="historia">
                        <i class="fas fa-book"></i>
                        <span>Hist√≥ria</span>
                    </button>
                </nav>
            </div>
            <div class="header-right">
                <span id="saveStatus" class="save-status">
                    <i class="fas fa-check-circle"></i> Salvo
                </span>
                <span id="userName"></span>
                <button id="switchCharBtn" class="btn-icon" title="Trocar Ficha">
                    <i class="fas fa-exchange-alt"></i>
                </button>
            </div>
        </header>

        <!-- Tab Content -->
        <main class="sheet-container">
            
            <!-- ==================== TELA PRINCIPAL ==================== -->
            <div id="tab-principal" class="tab-content active">
                <div class="principal-layout">
                    <!-- Coluna Esquerda: Imagem + Info B√°sica + Atributos -->
                    <div class="principal-left layout-container" data-container-id="principal-left">
                        <!-- Imagem do Personagem -->
                        <div class="character-portrait draggable-card" data-card-id="portrait">
                            <div class="portrait-container">
                                <img id="charPortrait" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%232a2a4a' width='100' height='100'/%3E%3Ctext x='50' y='55' text-anchor='middle' fill='%23666' font-size='12'%3EImagem%3C/text%3E%3C/svg%3E" alt="Retrato">
                                <label class="portrait-upload" title="Alterar imagem">
                                    <i class="fas fa-camera"></i>
                                    <input type="file" id="portraitInput" accept="image/*" hidden>
                                </label>
                            </div>
                        </div>

                        <!-- Info B√°sica -->
                        <div class="basic-info-card draggable-card" data-card-id="basic-info">
                            <div class="card-drag-handle"><i class="fas fa-grip-horizontal"></i></div>
                            <div class="form-group">
                                <label>Nome</label>
                                <input type="text" id="charName" data-field="charName" class="char-name-input">
                            </div>
                            <div class="info-row">
                                <div class="form-group">
                                    <label>Ra√ßa</label>
                                    <select id="charRace" data-field="charRace">
                                        <!-- Custom System Races (populated by JS) -->
                                        <optgroup label="Sistema Customizado" id="racesCustom" style="display: none;">
                                            <option value="">Selecione...</option>
                                        </optgroup>
                                        <!-- Realms&Scripts Races -->
                                        <optgroup label="Realms&Scripts" id="racesRealsscripts">
                                            <option value="">Selecione...</option>
                                            <option value="humano">Humano</option>
                                            <option value="elfo">Elfo</option>
                                            <option value="anao">An√£o</option>
                                            <option value="demonio">Dem√¥nio</option>
                                        </optgroup>
                                        <!-- D&D 5e Races -->
                                        <optgroup label="D&D 5e" id="racesDnd">
                                            <option value="human">Humano</option>
                                            <option value="humanVariant">Humano (Variante)</option>
                                            <option value="elf-high">Elfo (Alto)</option>
                                            <option value="elf-wood">Elfo (da Floresta)</option>
                                            <option value="elf-dark">Elfo (Drow)</option>
                                            <option value="dwarf-hill">An√£o (Colina)</option>
                                            <option value="dwarf-mountain">An√£o (Montanha)</option>
                                            <option value="halfling-lightfoot">Halfling (P√©s-Leves)</option>
                                            <option value="halfling-stout">Halfling (Robusto)</option>
                                            <option value="dragonborn">Draconato</option>
                                            <option value="gnome-forest">Gnomo (Floresta)</option>
                                            <option value="gnome-rock">Gnomo (Rocha)</option>
                                            <option value="half-elf">Meio-Elfo</option>
                                            <option value="half-orc">Meio-Orc</option>
                                            <option value="tiefling">Tiefling</option>
                                            <option value="aasimar">Aasimar</option>
                                            <option value="goliath">Golias</option>
                                            <option value="tabaxi">Tabaxi</option>
                                            <option value="kenku">Kenku</option>
                                            <option value="firbolg">Firbolg</option>
                                            <option value="tortle">Tortle</option>
                                            <option value="aarakocra">Aarakocra</option>
                                            <option value="genasi-air">Genasi (Ar)</option>
                                            <option value="genasi-earth">Genasi (Terra)</option>
                                            <option value="genasi-fire">Genasi (Fogo)</option>
                                            <option value="genasi-water">Genasi (√Ågua)</option>
                                            <option value="warforged">Forjados</option>
                                        </optgroup>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>N√≠vel</label>
                                    <div class="input-with-buttons">
                                        <button type="button" class="btn-adjust" onclick="Sheet.adjustValue('charLevel', -1)"><i class="fas fa-minus"></i></button>
                                        <input type="number" id="charLevel" data-field="charLevel" min="1" value="1">
                                        <button type="button" class="btn-adjust" onclick="Sheet.adjustValue('charLevel', 1)"><i class="fas fa-plus"></i></button>
                                    </div>
                                </div>
                            </div>
                            <!-- D&D Class Row -->
                            <div class="info-row class-section" id="classRow" style="display: none;">
                                <div class="form-group">
                                    <label>Classe</label>
                                    <select id="charClass" data-field="dndClass">
                                        <!-- Custom Classes (populated by JS) -->
                                        <optgroup label="Classes Customizadas" id="classesCustom" style="display: none;">
                                            <option value="">Selecione...</option>
                                        </optgroup>
                                        <!-- D&D 5e Classes -->
                                        <optgroup label="D&D 5e" id="classesDnd">
                                            <option value="">Selecione...</option>
                                            <option value="barbarian">B√°rbaro</option>
                                            <option value="bard">Bardo</option>
                                            <option value="cleric">Cl√©rigo</option>
                                            <option value="druid">Druida</option>
                                            <option value="fighter">Guerreiro</option>
                                            <option value="monk">Monge</option>
                                            <option value="paladin">Paladino</option>
                                            <option value="ranger">Patrulheiro</option>
                                            <option value="rogue">Ladino</option>
                                            <option value="sorcerer">Feiticeiro</option>
                                            <option value="warlock">Bruxo</option>
                                            <option value="wizard">Mago</option>
                                            <option value="artificer">Art√≠fice</option>
                                            <option value="blood-hunter">Ca√ßador de Sangue</option>
                                        </optgroup>
                                    </select>
                                </div>
                                <div class="form-group dnd-only">
                                    <label>Dado de Vida</label>
                                    <span id="hitDiceDisplay" class="calculated-small">d10</span>
                                </div>
                            </div>
                            <!-- Realms&Scripts PN Row -->
                            <div class="info-row rs-only" id="pnRow">
                                <div class="form-group">
                                    <label>PN Dispon√≠veis</label>
                                    <div class="input-with-buttons">
                                        <button type="button" class="btn-adjust" onclick="Sheet.adjustValue('levelPoints', -1)"><i class="fas fa-minus"></i></button>
                                        <input type="number" id="levelPoints" data-field="levelPoints" min="0" value="0">
                                        <button type="button" class="btn-adjust" onclick="Sheet.adjustValue('levelPoints', 1)"><i class="fas fa-plus"></i></button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>PN/N√≠vel</label>
                                    <span id="pnPerLevel" class="calculated-small">4</span>
                                </div>
                            </div>
                            <!-- D&D Proficiency -->
                            <div class="info-row dnd-only" id="profRow">
                                <div class="form-group">
                                    <label>B√¥nus de Profici√™ncia</label>
                                    <span id="profBonus" class="calculated-small">+2</span>
                                </div>
                                <div class="form-group">
                                    <label>Percep√ß√£o Passiva</label>
                                    <span id="passivePerception" class="calculated-small">10</span>
                                </div>
                            </div>
                            <div class="race-bonus" id="raceBonus"></div>
                        </div>

                        <!-- Atributos R&S -->
                        <div class="attributes-card draggable-card rs-only" data-card-id="attributes" id="attributesRS">
                            <div class="card-drag-handle"><i class="fas fa-grip-horizontal"></i></div>
                            <h3><i class="fas fa-fist-raised"></i> Atributos <small>(<span id="usedAttrPoints">0</span>/8)</small></h3>
                            <div class="attributes-compact">
                                <div class="attr-item">
                                    <span class="attr-label">FOR</span>
                                    <div class="attr-controls">
                                        <button type="button" class="btn-adjust btn-attr" onclick="Sheet.adjustValue('attrFor', -1)"><i class="fas fa-minus"></i></button>
                                        <input type="number" id="attrFor" data-field="attrFor" class="attr-input" value="0">
                                        <button type="button" class="btn-adjust btn-attr" onclick="Sheet.adjustValue('attrFor', 1)"><i class="fas fa-plus"></i></button>
                                    </div>
                                </div>
                                <div class="attr-item">
                                    <span class="attr-label">CON</span>
                                    <div class="attr-controls">
                                        <button type="button" class="btn-adjust btn-attr" onclick="Sheet.adjustValue('attrCon', -1)"><i class="fas fa-minus"></i></button>
                                        <input type="number" id="attrCon" data-field="attrCon" class="attr-input" value="0">
                                        <button type="button" class="btn-adjust btn-attr" onclick="Sheet.adjustValue('attrCon', 1)"><i class="fas fa-plus"></i></button>
                                    </div>
                                </div>
                                <div class="attr-item">
                                    <span class="attr-label">VON</span>
                                    <div class="attr-controls">
                                        <button type="button" class="btn-adjust btn-attr" onclick="Sheet.adjustValue('attrVon', -1)"><i class="fas fa-minus"></i></button>
                                        <input type="number" id="attrVon" data-field="attrVon" class="attr-input" value="0">
                                        <button type="button" class="btn-adjust btn-attr" onclick="Sheet.adjustValue('attrVon', 1)"><i class="fas fa-plus"></i></button>
                                    </div>
                                </div>
                                <div class="attr-item">
                                    <span class="attr-label">CAR</span>
                                    <div class="attr-controls">
                                        <button type="button" class="btn-adjust btn-attr" onclick="Sheet.adjustValue('attrCar', -1)"><i class="fas fa-minus"></i></button>
                                        <input type="number" id="attrCar" data-field="attrCar" class="attr-input" value="0">
                                        <button type="button" class="btn-adjust btn-attr" onclick="Sheet.adjustValue('attrCar', 1)"><i class="fas fa-plus"></i></button>
                                    </div>
                                </div>
                                <div class="attr-item">
                                    <span class="attr-label">INT</span>
                                    <div class="attr-controls">
                                        <button type="button" class="btn-adjust btn-attr" onclick="Sheet.adjustValue('attrInt', -1)"><i class="fas fa-minus"></i></button>
                                        <input type="number" id="attrInt" data-field="attrInt" class="attr-input" value="0">
                                        <button type="button" class="btn-adjust btn-attr" onclick="Sheet.adjustValue('attrInt', 1)"><i class="fas fa-plus"></i></button>
                                    </div>
                                </div>
                                <div class="attr-item">
                                    <span class="attr-label">AGI</span>
                                    <div class="attr-controls">
                                        <button type="button" class="btn-adjust btn-attr" onclick="Sheet.adjustValue('attrAgi', -1)"><i class="fas fa-minus"></i></button>
                                        <input type="number" id="attrAgi" data-field="attrAgi" class="attr-input" value="0">
                                        <button type="button" class="btn-adjust btn-attr" onclick="Sheet.adjustValue('attrAgi', 1)"><i class="fas fa-plus"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Atributos D&D -->
                        <div class="attributes-card draggable-card dnd-only" data-card-id="attributes-dnd" id="attributesDND">
                            <div class="card-drag-handle"><i class="fas fa-grip-horizontal"></i></div>
                            <h3><i class="fas fa-dice-d20"></i> Atributos</h3>
                            <div class="dnd-attributes-grid">
                                <div class="dnd-attr-item">
                                    <span class="dnd-attr-name">FOR</span>
                                    <span class="dnd-attr-mod" id="modStr">+0</span>
                                    <div class="dnd-attr-score">
                                        <button type="button" class="btn-adjust btn-attr-small" onclick="Sheet.adjustValue('dndStr', -1)"><i class="fas fa-minus"></i></button>
                                        <input type="number" id="dndStr" data-field="dndStr" class="dnd-score-input" value="10" min="1" max="30">
                                        <button type="button" class="btn-adjust btn-attr-small" onclick="Sheet.adjustValue('dndStr', 1)"><i class="fas fa-plus"></i></button>
                                    </div>
                                    <div class="dnd-save">
                                        <input type="checkbox" id="saveStr" data-field="saveProfStr" class="save-prof" title="Profici√™ncia em Salvaguarda">
                                        <span class="dnd-save-label">TR</span>
                                        <span id="saveStrVal">+0</span>
                                    </div>
                                </div>
                                <div class="dnd-attr-item">
                                    <span class="dnd-attr-name">DES</span>
                                    <span class="dnd-attr-mod" id="modDex">+0</span>
                                    <div class="dnd-attr-score">
                                        <button type="button" class="btn-adjust btn-attr-small" onclick="Sheet.adjustValue('dndDex', -1)"><i class="fas fa-minus"></i></button>
                                        <input type="number" id="dndDex" data-field="dndDex" class="dnd-score-input" value="10" min="1" max="30">
                                        <button type="button" class="btn-adjust btn-attr-small" onclick="Sheet.adjustValue('dndDex', 1)"><i class="fas fa-plus"></i></button>
                                    </div>
                                    <div class="dnd-save">
                                        <input type="checkbox" id="saveDex" data-field="saveProfDex" class="save-prof" title="Profici√™ncia em Salvaguarda">
                                        <span class="dnd-save-label">TR</span>
                                        <span id="saveDexVal">+0</span>
                                    </div>
                                </div>
                                <div class="dnd-attr-item">
                                    <span class="dnd-attr-name">CON</span>
                                    <span class="dnd-attr-mod" id="modCon">+0</span>
                                    <div class="dnd-attr-score">
                                        <button type="button" class="btn-adjust btn-attr-small" onclick="Sheet.adjustValue('dndCon', -1)"><i class="fas fa-minus"></i></button>
                                        <input type="number" id="dndCon" data-field="dndCon" class="dnd-score-input" value="10" min="1" max="30">
                                        <button type="button" class="btn-adjust btn-attr-small" onclick="Sheet.adjustValue('dndCon', 1)"><i class="fas fa-plus"></i></button>
                                    </div>
                                    <div class="dnd-save">
                                        <input type="checkbox" id="saveCon" data-field="saveProfCon" class="save-prof" title="Profici√™ncia em Salvaguarda">
                                        <span class="dnd-save-label">TR</span>
                                        <span id="saveConVal">+0</span>
                                    </div>
                                </div>
                                <div class="dnd-attr-item">
                                    <span class="dnd-attr-name">INT</span>
                                    <span class="dnd-attr-mod" id="modInt">+0</span>
                                    <div class="dnd-attr-score">
                                        <button type="button" class="btn-adjust btn-attr-small" onclick="Sheet.adjustValue('dndInt', -1)"><i class="fas fa-minus"></i></button>
                                        <input type="number" id="dndInt" data-field="dndInt" class="dnd-score-input" value="10" min="1" max="30">
                                        <button type="button" class="btn-adjust btn-attr-small" onclick="Sheet.adjustValue('dndInt', 1)"><i class="fas fa-plus"></i></button>
                                    </div>
                                    <div class="dnd-save">
                                        <input type="checkbox" id="saveInt" data-field="saveProfInt" class="save-prof" title="Profici√™ncia em Salvaguarda">
                                        <span class="dnd-save-label">TR</span>
                                        <span id="saveIntVal">+0</span>
                                    </div>
                                </div>
                                <div class="dnd-attr-item">
                                    <span class="dnd-attr-name">SAB</span>
                                    <span class="dnd-attr-mod" id="modWis">+0</span>
                                    <div class="dnd-attr-score">
                                        <button type="button" class="btn-adjust btn-attr-small" onclick="Sheet.adjustValue('dndWis', -1)"><i class="fas fa-minus"></i></button>
                                        <input type="number" id="dndWis" data-field="dndWis" class="dnd-score-input" value="10" min="1" max="30">
                                        <button type="button" class="btn-adjust btn-attr-small" onclick="Sheet.adjustValue('dndWis', 1)"><i class="fas fa-plus"></i></button>
                                    </div>
                                    <div class="dnd-save">
                                        <input type="checkbox" id="saveWis" data-field="saveProfWis" class="save-prof" title="Profici√™ncia em Salvaguarda">
                                        <span class="dnd-save-label">TR</span>
                                        <span id="saveWisVal">+0</span>
                                    </div>
                                </div>
                                <div class="dnd-attr-item">
                                    <span class="dnd-attr-name">CAR</span>
                                    <span class="dnd-attr-mod" id="modCha">+0</span>
                                    <div class="dnd-attr-score">
                                        <button type="button" class="btn-adjust btn-attr-small" onclick="Sheet.adjustValue('dndCha', -1)"><i class="fas fa-minus"></i></button>
                                        <input type="number" id="dndCha" data-field="dndCha" class="dnd-score-input" value="10" min="1" max="30">
                                        <button type="button" class="btn-adjust btn-attr-small" onclick="Sheet.adjustValue('dndCha', 1)"><i class="fas fa-plus"></i></button>
                                    </div>
                                    <div class="dnd-save">
                                        <input type="checkbox" id="saveCha" data-field="saveProfCha" class="save-prof" title="Profici√™ncia em Salvaguarda">
                                        <span class="dnd-save-label">TR</span>
                                        <span id="saveChaVal">+0</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Atributos Customizados (gerados dinamicamente) -->
                        <div class="attributes-card draggable-card custom-only" data-card-id="attributes-custom" id="attributesCustom" style="display: none;">
                            <div class="card-drag-handle"><i class="fas fa-grip-horizontal"></i></div>
                            <h3><i class="fas fa-chart-bar"></i> Atributos <small id="customAttrPointsInfo"></small></h3>
                            <div class="attributes-compact" id="customAttributesContainer">
                                <!-- Atributos customizados ser√£o gerados pelo JavaScript -->
                            </div>
                        </div>

                        <!-- Atributos Ordem Paranormal -->
                        <div class="attributes-card draggable-card op-only" data-card-id="attributes-op" id="attributesOP" style="display: none;">
                            <div class="card-drag-handle"><i class="fas fa-grip-horizontal"></i></div>
                            <h3><i class="fas fa-eye"></i> Atributos <small>(NEX: <span id="opNexDisplay">5%</span>)</small></h3>
                            <div class="op-attributes-grid">
                                <div class="op-attr-item">
                                    <span class="op-attr-name">AGI</span>
                                    <div class="op-attr-score">
                                        <button type="button" class="btn-adjust btn-attr-small" onclick="Sheet.adjustValue('opAgi', -1)"><i class="fas fa-minus"></i></button>
                                        <input type="number" id="opAgi" data-field="opAgi" class="op-score-input" value="1" min="0" max="5">
                                        <button type="button" class="btn-adjust btn-attr-small" onclick="Sheet.adjustValue('opAgi', 1)"><i class="fas fa-plus"></i></button>
                                    </div>
                                    <span class="op-attr-desc">Agilidade</span>
                                </div>
                                <div class="op-attr-item">
                                    <span class="op-attr-name">FOR</span>
                                    <div class="op-attr-score">
                                        <button type="button" class="btn-adjust btn-attr-small" onclick="Sheet.adjustValue('opFor', -1)"><i class="fas fa-minus"></i></button>
                                        <input type="number" id="opFor" data-field="opFor" class="op-score-input" value="1" min="0" max="5">
                                        <button type="button" class="btn-adjust btn-attr-small" onclick="Sheet.adjustValue('opFor', 1)"><i class="fas fa-plus"></i></button>
                                    </div>
                                    <span class="op-attr-desc">For√ßa</span>
                                </div>
                                <div class="op-attr-item">
                                    <span class="op-attr-name">INT</span>
                                    <div class="op-attr-score">
                                        <button type="button" class="btn-adjust btn-attr-small" onclick="Sheet.adjustValue('opInt', -1)"><i class="fas fa-minus"></i></button>
                                        <input type="number" id="opInt" data-field="opInt" class="op-score-input" value="1" min="0" max="5">
                                        <button type="button" class="btn-adjust btn-attr-small" onclick="Sheet.adjustValue('opInt', 1)"><i class="fas fa-plus"></i></button>
                                    </div>
                                    <span class="op-attr-desc">Intelecto</span>
                                </div>
                                <div class="op-attr-item">
                                    <span class="op-attr-name">PRE</span>
                                    <div class="op-attr-score">
                                        <button type="button" class="btn-adjust btn-attr-small" onclick="Sheet.adjustValue('opPre', -1)"><i class="fas fa-minus"></i></button>
                                        <input type="number" id="opPre" data-field="opPre" class="op-score-input" value="1" min="0" max="5">
                                        <button type="button" class="btn-adjust btn-attr-small" onclick="Sheet.adjustValue('opPre', 1)"><i class="fas fa-plus"></i></button>
                                    </div>
                                    <span class="op-attr-desc">Presen√ßa</span>
                                </div>
                                <div class="op-attr-item">
                                    <span class="op-attr-name">VIG</span>
                                    <div class="op-attr-score">
                                        <button type="button" class="btn-adjust btn-attr-small" onclick="Sheet.adjustValue('opVig', -1)"><i class="fas fa-minus"></i></button>
                                        <input type="number" id="opVig" data-field="opVig" class="op-score-input" value="1" min="0" max="5">
                                        <button type="button" class="btn-adjust btn-attr-small" onclick="Sheet.adjustValue('opVig', 1)"><i class="fas fa-plus"></i></button>
                                    </div>
                                    <span class="op-attr-desc">Vigor</span>
                                </div>
                            </div>
                            <!-- OP Trilha Selection -->
                            <div class="op-trilha-section">
                                <label>Trilha</label>
                                <select id="opTrilha" data-field="opTrilha">
                                    <option value="combatente">Combatente</option>
                                    <option value="especialista">Especialista</option>
                                    <option value="ocultista">Ocultista</option>
                                </select>
                            </div>
                            <!-- OP Defenses -->
                            <div class="op-defenses">
                                <div class="op-defense-item">
                                    <span class="defense-label">Reflexos</span>
                                    <span class="defense-value" id="opReflexos">10</span>
                                </div>
                                <div class="op-defense-item">
                                    <span class="defense-label">Fortitude</span>
                                    <span class="defense-value" id="opFortitude">10</span>
                                </div>
                                <div class="op-defense-item">
                                    <span class="defense-label">Vontade</span>
                                    <span class="defense-value" id="opVontade">10</span>
                                </div>
                            </div>
                        </div>

                        <!-- HP e Sanidade compactos -->
                        <div class="vitals-compact-card draggable-card" data-card-id="vitals">
                            <div class="vital-compact hp-compact">
                                <i class="fas fa-heart vital-icon"></i>
                                <span class="vital-label">HP</span>
                                <div class="vital-values">
                                    <input type="number" id="currentHpMain" class="vital-current" min="0" value="20">
                                    <span class="vital-separator">/</span>
                                    <span id="maxHpMain" class="vital-max">20</span>
                                </div>
                                <div class="vital-btns">
                                    <button type="button" class="vital-btn btn-adjust" onclick="Sheet.adjustValue('currentHpMain', -1)"><i class="fas fa-minus"></i></button>
                                    <button type="button" class="vital-btn btn-adjust" onclick="Sheet.adjustValue('currentHpMain', 1)"><i class="fas fa-plus"></i></button>
                                </div>
                            </div>
                            <div class="vital-compact san-compact rs-op-only">
                                <i class="fas fa-brain vital-icon"></i>
                                <span class="vital-label">Sanidade</span>
                                <div class="vital-values">
                                    <input type="number" id="sanityMain" class="vital-current" min="0" value="20">
                                    <span class="vital-separator">/</span>
                                    <span id="maxSanityMain" class="vital-max">20</span>
                                </div>
                                <div class="vital-btns">
                                    <button type="button" class="vital-btn btn-adjust" onclick="Sheet.adjustValue('sanityMain', -1)"><i class="fas fa-minus"></i></button>
                                    <button type="button" class="vital-btn btn-adjust" onclick="Sheet.adjustValue('sanityMain', 1)"><i class="fas fa-plus"></i></button>
                                </div>
                            </div>
                            <div class="vital-compact pe-compact rs-op-only">
                                <i class="fas fa-bolt vital-icon"></i>
                                <span class="vital-label">PE</span>
                                <div class="vital-values">
                                    <input type="number" id="currentPEMain" class="vital-current" min="0" value="6">
                                    <span class="vital-separator">/</span>
                                    <span id="maxPEMain" class="vital-max">6</span>
                                </div>
                                <div class="vital-btns">
                                    <button type="button" class="vital-btn btn-adjust" onclick="Sheet.adjustValue('currentPEMain', -1)"><i class="fas fa-minus"></i></button>
                                    <button type="button" class="vital-btn btn-adjust" onclick="Sheet.adjustValue('currentPEMain', 1)"><i class="fas fa-plus"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Coluna Direita: Invent√°rio -->
                    <div class="principal-right layout-container" data-container-id="principal-right">
                        <div class="inventory-card draggable-card" data-card-id="inventory">
                            <div class="card-drag-handle"><i class="fas fa-grip-horizontal"></i></div>
                            <h3>
                                <i class="fas fa-backpack"></i> Invent√°rio
                                <span class="weight-display">
                                    <span id="currentWeight">0</span> / <span id="maxWeight">12</span> kg
                                    <span id="weightStatus" class="weight-badge normal">OK</span>
                                </span>
                            </h3>
                            
                            <!-- Ouro -->
                            <div class="gold-bar">
                                <i class="fas fa-coins"></i>
                                <input type="number" id="gold" data-field="gold" min="0" value="0" step="0.01">
                                <span>Ouro</span>
                            </div>

                            <!-- Armadura -->
                            <div class="armor-bar">
                                <label>Armadura:</label>
                                <select id="armorType" data-field="armorType">
                                    <option value="none">Nenhuma (0)</option>
                                    <option value="light">Leve (+3 CA, 3kg)</option>
                                    <option value="medium">M√©dia (+5 CA, 3kg, -2 pen.)</option>
                                    <option value="heavy">Pesada (+7 CA, 7kg, -5 pen.)</option>
                                </select>
                            </div>

                            <!-- Lista de Itens -->
                            <div class="inventory-list">
                                <div class="inventory-header">
                                    <span>Item</span>
                                    <span>Peso (kg)</span>
                                    <span></span>
                                </div>
                                <div id="inventoryItems">
                                    <!-- Items ser√£o gerados por JS -->
                                </div>
                                <button id="addItemBtn" class="btn-add-item">
                                    <i class="fas fa-plus"></i> Adicionar Item
                                </button>
                            </div>

                            <!-- Status de Peso -->
                            <div class="weight-info">
                                <small>M√°x: <span id="maxWeightInfo">12</span>kg | Pesado: <span id="heavyWeightInfo">18</span>kg</small>
                            </div>
                        </div>

                        <!-- Notas R√°pidas -->
                        <div class="notes-card draggable-card" data-card-id="quick-notes">
                            <div class="card-drag-handle"><i class="fas fa-grip-horizontal"></i></div>
                            <h3><i class="fas fa-sticky-note"></i> Notas R√°pidas</h3>
                            <textarea id="quickNotes" data-field="quickNotes" placeholder="Anota√ß√µes..."></textarea>
                        </div>

                        <!-- Per√≠cias Treinadas -->
                        <div class="trained-skills-card draggable-card" data-card-id="trained-skills">
                            <div class="card-drag-handle"><i class="fas fa-grip-horizontal"></i></div>
                            <h3><i class="fas fa-star"></i> Per√≠cias Treinadas</h3>
                            <div id="trainedSkillsList" class="trained-skills-list">
                                <p class="no-skills">Nenhuma per√≠cia treinada</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ==================== TELA DE COMBATE ==================== -->
            <div id="tab-combate" class="tab-content">
                <div class="combat-layout layout-container" data-container-id="combat-main">
                    <!-- Status Vitais -->
                    <div class="vital-stats draggable-card" data-card-id="combat-vitals">
                        <div class="card-drag-handle"><i class="fas fa-grip-horizontal"></i></div>
                        <div class="vital-box hp-box">
                            <div class="vital-icon"><i class="fas fa-heart"></i></div>
                            <div class="vital-info">
                                <label>HP</label>
                                <div class="vital-values">
                                    <input type="number" id="currentHp" data-field="currentHp" class="vital-current" min="0" value="20">
                                    <span>/</span>
                                    <span id="maxHp" class="vital-max">20</span>
                                </div>
                                <div class="vital-bar">
                                    <div id="hpBar" class="bar-fill hp-fill" style="width: 100%"></div>
                                </div>
                                <div class="vital-buttons">
                                    <button type="button" class="btn-adjust" onclick="Sheet.adjustValue('currentHp', -1)"><i class="fas fa-minus"></i></button>
                                    <button type="button" class="btn-adjust" onclick="Sheet.adjustValue('currentHp', 1)"><i class="fas fa-plus"></i></button>
                                    <button type="button" class="btn-restore" onclick="Sheet.restoreHp()" title="Restaurar HP"><i class="fas fa-heart"></i></button>
                                </div>
                            </div>
                        </div>

                        <div class="vital-box san-box rs-op-only">
                            <div class="vital-icon"><i class="fas fa-brain"></i></div>
                            <div class="vital-info">
                                <label>Sanidade</label>
                                <div class="vital-values">
                                    <input type="number" id="sanity" data-field="sanity" class="vital-current" min="0" value="20">
                                    <span>/</span>
                                    <span id="maxSanity" class="vital-max">20</span>
                                </div>
                                <div class="vital-bar">
                                    <div id="sanBar" class="bar-fill san-fill" style="width: 100%"></div>
                                </div>
                                <div class="vital-buttons">
                                    <button type="button" class="btn-adjust" onclick="Sheet.adjustValue('sanity', -1)"><i class="fas fa-minus"></i></button>
                                    <button type="button" class="btn-adjust" onclick="Sheet.adjustValue('sanity', 1)"><i class="fas fa-plus"></i></button>
                                    <button type="button" class="btn-restore" onclick="Sheet.restoreSanity()" title="Restaurar Sanidade"><i class="fas fa-brain"></i></button>
                                </div>
                            </div>
                        </div>

                        <div class="vital-box pe-box rs-op-only">
                            <div class="vital-icon"><i class="fas fa-bolt"></i></div>
                            <div class="vital-info">
                                <label>PE</label>
                                <div class="vital-values">
                                    <input type="number" id="currentPE" data-field="currentPE" class="vital-current" min="0" value="6">
                                    <span>/</span>
                                    <span id="maxPE" class="vital-max">6</span>
                                </div>
                                <div class="vital-bar">
                                    <div id="peBar" class="bar-fill pe-fill" style="width: 100%"></div>
                                </div>
                                <div class="vital-buttons">
                                    <button type="button" class="btn-adjust" onclick="Sheet.adjustValue('currentPE', -1)"><i class="fas fa-minus"></i></button>
                                    <button type="button" class="btn-adjust" onclick="Sheet.adjustValue('currentPE', 1)"><i class="fas fa-plus"></i></button>
                                    <button type="button" class="btn-restore" onclick="Sheet.restorePE()" title="Restaurar PE"><i class="fas fa-bolt"></i></button>
                                </div>
                            </div>
                        </div>

                        <div class="vital-box pa-box rs-only">
                            <div class="vital-icon"><i class="fas fa-running"></i></div>
                            <div class="vital-info">
                                <label>PA</label>
                                <div class="vital-values">
                                    <input type="number" id="currentPA" data-field="currentPA" class="vital-current" min="0" value="5">
                                    <span>/</span>
                                    <span id="maxPA" class="vital-max">5</span>
                                </div>
                                <div class="vital-bar">
                                    <div id="paBar" class="bar-fill pa-fill" style="width: 100%"></div>
                                </div>
                                <div class="vital-buttons">
                                    <button type="button" class="btn-adjust" onclick="Sheet.adjustValue('currentPA', -1)"><i class="fas fa-minus"></i></button>
                                    <button type="button" class="btn-adjust" onclick="Sheet.adjustValue('currentPA', 1)"><i class="fas fa-plus"></i></button>
                                    <button type="button" class="btn-next-turn" onclick="Sheet.nextTurn()" title="Pr√≥ximo Turno"><i class="fas fa-redo"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Defesas -->
                    <div class="defense-stats draggable-card" data-card-id="combat-defenses">
                        <div class="card-drag-handle"><i class="fas fa-grip-horizontal"></i></div>
                        <div class="defense-box">
                            <i class="fas fa-shield-alt"></i>
                            <label>CA</label>
                            <span id="armorClass" class="defense-value">10</span>
                        </div>
                        <div class="defense-box">
                            <i class="fas fa-wind"></i>
                            <label>Esquiva</label>
                            <span id="dodge" class="defense-value">10</span>
                        </div>
                        <div class="defense-box">
                            <i class="fas fa-bolt"></i>
                            <label>Iniciativa</label>
                            <span id="initiative" class="defense-value">+0</span>
                        </div>
                    </div>

                    <!-- Redu√ß√µes de Dano -->
                    <div class="damage-reduction draggable-card" data-card-id="combat-reduction">
                        <div class="card-drag-handle"><i class="fas fa-grip-horizontal"></i></div>
                        <h3><i class="fas fa-shield-virus"></i> Redu√ß√µes de Dano</h3>
                        <div class="reduction-grid">
                            <div class="reduction-item">
                                <span>Ao Defender (Bra√ßos)</span>
                                <span id="reduceDefend" class="reduction-value">0</span>
                            </div>
                            <div class="reduction-item">
                                <span>Dano Geral</span>
                                <span id="reduceDamage" class="reduction-value">0</span>
                            </div>
                            <div class="reduction-item">
                                <span>Dano de Queda</span>
                                <span id="reduceFall" class="reduction-value">0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Ataques Realms&Scripts -->
                    <div class="attacks-section draggable-card rs-only" data-card-id="combat-attacks">
                        <div class="card-drag-handle"><i class="fas fa-grip-horizontal"></i></div>
                        <h3><i class="fas fa-crosshairs"></i> Ataques</h3>
                        <div class="attacks-table-container">
                            <table class="attacks-table">
                                <thead>
                                    <tr>
                                        <th>Usar</th>
                                        <th>Nome</th>
                                        <th>Dano</th>
                                        <th>Dist.</th>
                                        <th>Per√≠cia</th>
                                        <th>PA</th>
                                        <th>PE</th>
                                        <th>Crit</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="attacksBody">
                                    <!-- Ataques ser√£o gerados por JS -->
                                </tbody>
                            </table>
                            <button id="addAttackBtn" class="btn-add-item">
                                <i class="fas fa-plus"></i> Adicionar Ataque
                            </button>
                        </div>
                    </div>

                    <!-- Ataques D&D 5e -->
                    <div class="attacks-section draggable-card dnd-only" data-card-id="combat-attacks-dnd">
                        <div class="card-drag-handle"><i class="fas fa-grip-horizontal"></i></div>
                        <h3><i class="fas fa-crosshairs"></i> Ataques e Magias</h3>
                        <div class="attacks-table-container">
                            <table class="attacks-table dnd-attacks-table">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Ataque</th>
                                        <th>Dano/Tipo</th>
                                        <th>Alcance</th>
                                        <th>Propriedades</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="dndAttacksBody">
                                    <!-- Ataques D&D ser√£o gerados por JS -->
                                </tbody>
                            </table>
                            <button id="addDndAttackBtn" class="btn-add-item">
                                <i class="fas fa-plus"></i> Adicionar Ataque
                            </button>
                        </div>
                    </div>

                    <!-- Per√≠cias de Combate -->
                    <div class="combat-skills-section draggable-card" data-card-id="combat-skills">
                        <div class="card-drag-handle"><i class="fas fa-grip-horizontal"></i></div>
                        <h3><i class="fas fa-fist-raised"></i> Per√≠cias de Combate</h3>
                        <div class="combat-skills-grid" id="combatSkillsGrid">
                            <!-- Per√≠cias de combate ser√£o geradas por JS -->
                        </div>
                    </div>

                    <!-- Habilidades -->
                    <div class="abilities-section draggable-card" data-card-id="combat-abilities">
                        <div class="card-drag-handle"><i class="fas fa-grip-horizontal"></i></div>
                        <h3><i class="fas fa-magic"></i> Habilidades e Poderes</h3>
                        <textarea id="abilities" data-field="abilities" placeholder="Liste suas habilidades, poderes e magias..."></textarea>
                    </div>
                </div>
            </div>

            <!-- ==================== TELA DE PER√çCIAS E FUS√ïES ==================== -->
            <div id="tab-pericias" class="tab-content">
                <div class="skills-page-layout layout-container" data-container-id="skills-main">
                    <!-- Per√≠cias -->
                    <div class="skills-section-box draggable-card" data-card-id="skills-list">
                        <div class="card-drag-handle"><i class="fas fa-grip-horizontal"></i></div>
                        <div class="skills-header">
                            <h2><i class="fas fa-star"></i> Per√≠cias</h2>
                            <!-- Legenda Realms&Scripts -->
                            <div class="skill-legend rs-only">
                                <span class="legend-item"><span class="dot untrained"></span> Sem Treino (+0)</span>
                                <span class="legend-item"><span class="dot trained"></span> Treinada (+1)</span>
                                <span class="legend-item"><span class="dot veteran"></span> Veterana (+3)</span>
                                <span class="legend-item"><span class="dot expert"></span> Expert (+5)</span>
                                <span class="legend-item"><i class="fas fa-weight-hanging" style="color: var(--warning);"></i> Penalidade</span>
                                <div class="skill-search">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="skillSearchInput" placeholder="Buscar...">
                                </div>
                            </div>
                            <!-- Legenda D&D 5e -->
                            <div class="skill-legend dnd-only">
                                <span class="legend-item"><input type="checkbox" disabled> Proficiente (+B√¥nus)</span>
                                <span class="legend-item"><input type="checkbox" checked disabled> <input type="checkbox" checked disabled> Expertise (√ó2)</span>
                                <div class="skill-search">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="skillSearchInputDnd" placeholder="Buscar...">
                                </div>
                            </div>
                        </div>
                        <div class="skills-grid" id="skillsGrid">
                            <!-- Skills ser√£o geradas por JS -->
                        </div>
                    </div>

                    <!-- Fus√µes (Realms&Scripts only) -->
                    <div class="fusions-section draggable-card rs-only" data-card-id="fusions">
                        <div class="card-drag-handle"><i class="fas fa-grip-horizontal"></i></div>
                        <h3><i class="fas fa-dna"></i> Fus√µes</h3>
                        
                        <div class="fusion-row">
                            <h4>√ìrg√£os Vitais</h4>
                            <div class="fusion-grid">
                                <div class="fusion-item">
                                    <label><i class="fas fa-brain"></i> C√©rebro</label>
                                    <select id="fusionBrainSkills" data-field="fusionBrain">
                                        <option value="1">Vermelho (√ó1)</option>
                                        <option value="1.5">Rosa Escuro (√ó1.5)</option>
                                        <option value="2">Rosa Sock (√ó2)</option>
                                        <option value="2.5">Rosa Claro (√ó2.5)</option>
                                        <option value="3">Prata (√ó3)</option>
                                        <option value="4">Branco (√ó4)</option>
                                    </select>
                                </div>
                                <div class="fusion-item">
                                    <label><i class="fas fa-heart"></i> Cora√ß√£o</label>
                                    <select id="fusionHeartSkills" data-field="fusionHeart">
                                        <option value="1">Vermelho (√ó1)</option>
                                        <option value="1.5">Rosa Escuro (√ó1.5)</option>
                                        <option value="2">Rosa Sock (√ó2)</option>
                                        <option value="2.5">Rosa Claro (√ó2.5)</option>
                                        <option value="3">Prata (√ó3)</option>
                                        <option value="4">Branco (√ó4)</option>
                                    </select>
                                </div>
                                <div class="fusion-item">
                                    <label><i class="fas fa-eye"></i> Olhos</label>
                                    <select id="fusionEyesSkills" data-field="fusionEyes">
                                        <option value="normal">N√£o Fundido</option>
                                        <option value="fused">Fundido</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="fusion-row">
                            <h4>Ossos (Redu√ß√£o de Dano)</h4>
                            <div class="fusion-grid">
                                <div class="fusion-item">
                                    <label>Bra√ßos</label>
                                    <select id="fusionBoneArmsSkills" data-field="fusionBoneArms">
                                        <option value="0">Normal</option>
                                        <option value="2">Transiente (-2)</option>
                                        <option value="4">Mesclado (-4)</option>
                                        <option value="6">Integrado (-6)</option>
                                        <option value="8">Fundido (-8)</option>
                                    </select>
                                </div>
                                <div class="fusion-item">
                                    <label>Cabe√ßa</label>
                                    <select id="fusionBoneHeadSkills" data-field="fusionBoneHead">
                                        <option value="0">Normal</option>
                                        <option value="1">Transiente (-1)</option>
                                        <option value="2">Mesclado (-2)</option>
                                        <option value="3">Integrado (-3)</option>
                                        <option value="4">Fundido (-4)</option>
                                    </select>
                                </div>
                                <div class="fusion-item">
                                    <label>Costas</label>
                                    <select id="fusionBoneBackSkills" data-field="fusionBoneBack">
                                        <option value="0">Normal</option>
                                        <option value="1">Transiente (-1)</option>
                                        <option value="2">Mesclado (-2)</option>
                                        <option value="3">Integrado (-3)</option>
                                        <option value="4">Fundido (-4)</option>
                                    </select>
                                </div>
                                <div class="fusion-item">
                                    <label>Peitoral</label>
                                    <select id="fusionBoneChestSkills" data-field="fusionBoneChest">
                                        <option value="0">Normal</option>
                                        <option value="1">Transiente (-1)</option>
                                        <option value="2">Mesclado (-2)</option>
                                        <option value="3">Integrado (-3)</option>
                                        <option value="4">Fundido (-4)</option>
                                    </select>
                                </div>
                                <div class="fusion-item">
                                    <label>Pernas</label>
                                    <select id="fusionBoneLegsSkills" data-field="fusionBoneLegs">
                                        <option value="0">Normal</option>
                                        <option value="2">Transiente (-2)</option>
                                        <option value="4">Mesclado (-4)</option>
                                        <option value="6">Integrado (-6)</option>
                                        <option value="8">Fundido (-8)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="fusion-row">
                            <h4>M√∫sculos (B√¥nus em Per√≠cias)</h4>
                            <div class="fusion-grid">
                                <div class="fusion-item">
                                    <label>Bra√ßos (+Luta)</label>
                                    <select id="fusionMuscleArmsSkills" data-field="fusionMuscleArms">
                                        <option value="0">Normal</option>
                                        <option value="1">Rosa (+1)</option>
                                        <option value="2">Rosa Claro (+2)</option>
                                        <option value="3">Prata (+3)</option>
                                        <option value="4">Branco (+4)</option>
                                    </select>
                                </div>
                                <div class="fusion-item">
                                    <label>Cabe√ßa (+Percep√ß√£o)</label>
                                    <select id="fusionMuscleHeadSkills" data-field="fusionMuscleHead">
                                        <option value="0">Normal</option>
                                        <option value="1">Rosa (+1)</option>
                                        <option value="2">Rosa Claro (+2)</option>
                                        <option value="3">Prata (+3)</option>
                                        <option value="4">Branco (+4)</option>
                                    </select>
                                </div>
                                <div class="fusion-item">
                                    <label>Costas (+Pontaria)</label>
                                    <select id="fusionMuscleBackSkills" data-field="fusionMuscleBack">
                                        <option value="0">Normal</option>
                                        <option value="1">Rosa (+1)</option>
                                        <option value="2">Rosa Claro (+2)</option>
                                        <option value="3">Prata (+3)</option>
                                        <option value="4">Branco (+4)</option>
                                    </select>
                                </div>
                                <div class="fusion-item">
                                    <label>Peitoral (+Atletismo)</label>
                                    <select id="fusionMuscleChestSkills" data-field="fusionMuscleChest">
                                        <option value="0">Normal</option>
                                        <option value="1">Rosa (+1)</option>
                                        <option value="2">Rosa Claro (+2)</option>
                                        <option value="3">Prata (+3)</option>
                                        <option value="4">Branco (+4)</option>
                                    </select>
                                </div>
                                <div class="fusion-item">
                                    <label>Pernas (+Acrobacia)</label>
                                    <select id="fusionMuscleLegsSkills" data-field="fusionMuscleLegs">
                                        <option value="0">Normal</option>
                                        <option value="1">Rosa (+1)</option>
                                        <option value="2">Rosa Claro (+2)</option>
                                        <option value="3">Prata (+3)</option>
                                        <option value="4">Branco (+4)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ==================== TELA DE HIST√ìRIA ==================== -->
            <div id="tab-historia" class="tab-content">
                <div class="history-layout layout-container" data-container-id="history-main">
                    <!-- Apar√™ncia -->
                    <div class="history-section draggable-card" data-card-id="appearance">
                        <div class="card-drag-handle"><i class="fas fa-grip-horizontal"></i></div>
                        <h3><i class="fas fa-eye"></i> Apar√™ncia</h3>
                        <div class="appearance-grid">
                            <div class="form-group">
                                <label>Idade</label>
                                <input type="text" id="age" data-field="age">
                            </div>
                            <div class="form-group">
                                <label>Altura</label>
                                <input type="text" id="height" data-field="height">
                            </div>
                            <div class="form-group">
                                <label>Peso</label>
                                <input type="text" id="charWeight" data-field="charWeight">
                            </div>
                            <div class="form-group">
                                <label>Olhos</label>
                                <input type="text" id="eyes" data-field="eyes">
                            </div>
                            <div class="form-group">
                                <label>Pele</label>
                                <input type="text" id="skin" data-field="skin">
                            </div>
                            <div class="form-group">
                                <label>Cabelo</label>
                                <input type="text" id="hair" data-field="hair">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Descri√ß√£o da Apar√™ncia</label>
                            <textarea id="appearanceDesc" data-field="appearanceDesc" placeholder="Descreva a apar√™ncia do seu personagem..."></textarea>
                        </div>
                    </div>

                    <!-- Personalidade -->
                    <div class="history-section draggable-card" data-card-id="personality">
                        <div class="card-drag-handle"><i class="fas fa-grip-horizontal"></i></div>
                        <h3><i class="fas fa-theater-masks"></i> Personalidade</h3>
                        <div class="personality-grid">
                            <div class="form-group">
                                <label>Tra√ßos de Personalidade</label>
                                <textarea id="personalityTraits" data-field="personalityTraits"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Ideais</label>
                                <textarea id="ideals" data-field="ideals"></textarea>
                            </div>
                            <div class="form-group">
                                <label>V√≠nculos</label>
                                <textarea id="bonds" data-field="bonds"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Fraquezas</label>
                                <textarea id="flaws" data-field="flaws"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Hist√≥ria -->
                    <div class="history-section draggable-card" data-card-id="backstory">
                        <div class="card-drag-handle"><i class="fas fa-grip-horizontal"></i></div>
                        <h3><i class="fas fa-book"></i> Hist√≥ria do Personagem</h3>
                        <textarea id="backstory" data-field="backstory" class="large-textarea" placeholder="Conte a hist√≥ria do seu personagem..."></textarea>
                    </div>

                    <!-- Anota√ß√µes -->
                    <div class="history-section draggable-card" data-card-id="notes">
                        <div class="card-drag-handle"><i class="fas fa-grip-horizontal"></i></div>
                        <h3><i class="fas fa-sticky-note"></i> Anota√ß√µes</h3>
                        <textarea id="notes" data-field="notes" class="large-textarea" placeholder="Anota√ß√µes gerais, lembretes, etc..."></textarea>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <!-- #endregion CONTE√öDO PRINCIPAL (FICHA) -->

    <!-- #region SYSTEM EDITOR FULL-SCREEN -->
    <!-- ========== FULL-SCREEN SYSTEM EDITOR ========== -->
    <div id="systemEditorScreen">
        <div class="sys-editor-layout">
            <!-- Sidebar Navigation -->
            <aside class="sys-editor-sidebar">
                <div class="sys-editor-sidebar-header">
                    <h2><i class="fas fa-cogs"></i> <span>Editor de Sistema</span></h2>
                    <p id="sysEditingName">Novo Sistema</p>
                </div>
                
                <nav class="sys-editor-nav">
                    <div class="sys-nav-section">
                        <div class="sys-nav-section-title">Geral</div>
                        <div class="sys-nav-item active" data-panel="overview">
                            <i class="fas fa-home"></i>
                            <span>Vis√£o Geral</span>
                        </div>
                        <div class="sys-nav-item" data-panel="basic">
                            <i class="fas fa-info-circle"></i>
                            <span>Informa√ß√µes</span>
                        </div>
                    </div>
                    
                    <div class="sys-nav-section">
                        <div class="sys-nav-section-title">Personagem</div>
                        <div class="sys-nav-item" data-panel="attributes">
                            <i class="fas fa-fist-raised"></i>
                            <span>Atributos</span>
                        </div>
                        <div class="sys-nav-item" data-panel="resources">
                            <i class="fas fa-heart"></i>
                            <span>Recursos</span>
                        </div>
                        <div class="sys-nav-item" data-panel="classes">
                            <i class="fas fa-hat-wizard"></i>
                            <span>Classes</span>
                        </div>
                        <div class="sys-nav-item" data-panel="races">
                            <i class="fas fa-users"></i>
                            <span>Ra√ßas</span>
                        </div>
                    </div>
                    
                    <div class="sys-nav-section">
                        <div class="sys-nav-section-title">Mec√¢nicas</div>
                        <div class="sys-nav-item" data-panel="skills">
                            <i class="fas fa-book-open"></i>
                            <span>Per√≠cias</span>
                        </div>
                        <div class="sys-nav-item" data-panel="combat">
                            <i class="fas fa-shield-alt"></i>
                            <span>Combate</span>
                        </div>
                        <div class="sys-nav-item" data-panel="magic">
                            <i class="fas fa-magic"></i>
                            <span>Magias</span>
                        </div>
                    </div>
                    
                    <div class="sys-nav-section">
                        <div class="sys-nav-section-title">Avan√ßado</div>
                        <div class="sys-nav-item" data-panel="fields">
                            <i class="fas fa-th-list"></i>
                            <span>Campos</span>
                        </div>
                    </div>
                </nav>
                
                <div class="sys-editor-sidebar-footer">
                    <button class="btn-primary" onclick="SystemEditor.save()">
                        <i class="fas fa-save"></i> <span>Salvar</span>
                    </button>
                    <button class="btn-secondary" onclick="SystemEditor.close()">
                        <i class="fas fa-times"></i> <span>Fechar</span>
                    </button>
                    <button class="btn-danger" id="sysDeleteBtn" onclick="SystemEditor.confirmDelete()">
                        <i class="fas fa-trash"></i> <span>Excluir</span>
                    </button>
                </div>
            </aside>
            
            <!-- Main Content Area -->
            <main class="sys-editor-main">
                <!-- ==================== VIS√ÉO GERAL ==================== -->
                <div class="sys-panel active" id="panel-overview">
                    <div class="sys-editor-content-header">
                        <div>
                            <h2><i class="fas fa-home"></i> Vis√£o Geral do Sistema</h2>
                            <p>Resumo das configura√ß√µes e estat√≠sticas</p>
                        </div>
                    </div>
                    <div class="sys-editor-content-body">
                        <div class="sys-form-section">
                            <h3><i class="fas fa-chart-pie"></i> Resumo</h3>
                            <div class="sys-cards-grid" id="sysOverviewStats">
                                <div class="sys-card">
                                    <div class="sys-card-header">
                                        <div class="sys-card-icon"><i class="fas fa-fist-raised"></i></div>
                                        <div class="sys-card-title">
                                            <h4 id="ovAttrCount">6</h4>
                                            <span>Atributos</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="sys-card">
                                    <div class="sys-card-header">
                                        <div class="sys-card-icon"><i class="fas fa-book-open"></i></div>
                                        <div class="sys-card-title">
                                            <h4 id="ovSkillCount">18</h4>
                                            <span>Per√≠cias</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="sys-card">
                                    <div class="sys-card-header">
                                        <div class="sys-card-icon"><i class="fas fa-hat-wizard"></i></div>
                                        <div class="sys-card-title">
                                            <h4 id="ovClassCount">0</h4>
                                            <span>Classes</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="sys-card">
                                    <div class="sys-card-header">
                                        <div class="sys-card-icon"><i class="fas fa-users"></i></div>
                                        <div class="sys-card-title">
                                            <h4 id="ovRaceCount">0</h4>
                                            <span>Ra√ßas</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="sys-form-section">
                            <h3><i class="fas fa-toggle-on"></i> Recursos Ativos</h3>
                            <div id="sysOverviewFeatures" class="sys-cards-grid">
                                <!-- Rendered by JS -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ==================== INFORMA√á√ïES B√ÅSICAS ==================== -->
                <div class="sys-panel" id="panel-basic">
                    <div class="sys-editor-content-header">
                        <div>
                            <h2><i class="fas fa-info-circle"></i> Informa√ß√µes B√°sicas</h2>
                            <p>Nome, descri√ß√£o e apar√™ncia do sistema</p>
                        </div>
                    </div>
                    <div class="sys-editor-content-body">
                        <div class="sys-form-section">
                            <h3><i class="fas fa-id-card"></i> Identifica√ß√£o</h3>
                            <div class="sys-form-grid">
                                <div class="sys-form-group">
                                    <label class="required">Nome do Sistema</label>
                                    <input type="text" id="sysName" placeholder="Ex: Meu Sistema Personalizado">
                                </div>
                                <div class="sys-form-group">
                                    <label>Vers√£o</label>
                                    <input type="text" id="sysVersion" placeholder="Ex: 1.0">
                                </div>
                            </div>
                            <div class="sys-form-group">
                                <label>Descri√ß√£o</label>
                                <textarea id="sysDescription" placeholder="Descreva o sistema, suas principais mec√¢nicas e diferen√ßas..."></textarea>
                            </div>
                        </div>
                        
                        <div class="sys-form-section">
                            <h3><i class="fas fa-palette"></i> Apar√™ncia</h3>
                            <div class="sys-form-group">
                                <label>√çcone do Sistema</label>
                                <div class="sys-icon-picker" id="sysIconPicker">
                                    <div class="sys-icon-option selected" data-icon="fa-dice-d20"><i class="fas fa-dice-d20"></i></div>
                                    <div class="sys-icon-option" data-icon="fa-scroll"><i class="fas fa-scroll"></i></div>
                                    <div class="sys-icon-option" data-icon="fa-dragon"><i class="fas fa-dragon"></i></div>
                                    <div class="sys-icon-option" data-icon="fa-hat-wizard"><i class="fas fa-hat-wizard"></i></div>
                                    <div class="sys-icon-option" data-icon="fa-shield-alt"><i class="fas fa-shield-alt"></i></div>
                                    <div class="sys-icon-option" data-icon="fa-sword"><i class="fas fa-sword"></i></div>
                                    <div class="sys-icon-option" data-icon="fa-skull"><i class="fas fa-skull"></i></div>
                                    <div class="sys-icon-option" data-icon="fa-star"><i class="fas fa-star"></i></div>
                                    <div class="sys-icon-option" data-icon="fa-bolt"><i class="fas fa-bolt"></i></div>
                                    <div class="sys-icon-option" data-icon="fa-fire"><i class="fas fa-fire"></i></div>
                                    <div class="sys-icon-option" data-icon="fa-gem"><i class="fas fa-gem"></i></div>
                                    <div class="sys-icon-option" data-icon="fa-crown"><i class="fas fa-crown"></i></div>
                                    <div class="sys-icon-option" data-icon="fa-dungeon"><i class="fas fa-dungeon"></i></div>
                                    <div class="sys-icon-option" data-icon="fa-chess-rook"><i class="fas fa-chess-rook"></i></div>
                                    <div class="sys-icon-option" data-icon="fa-khanda"><i class="fas fa-khanda"></i></div>
                                    <div class="sys-icon-option" data-icon="fa-ghost"><i class="fas fa-ghost"></i></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="sys-form-section">
                            <h3><i class="fas fa-sliders-h"></i> Configura√ß√µes Gerais</h3>
                            <div class="sys-toggle-row">
                                <div class="sys-toggle-info">
                                    <span>Baseado em Template</span>
                                    <small>Copiar configura√ß√µes de um sistema existente</small>
                                </div>
                                <select id="sysBaseTemplate" style="width: 200px;">
                                    <option value="">Nenhum (criar do zero)</option>
                                    <option value="realsscripts">Realms&Scripts</option>
                                    <option value="dnd5e">D&D 5e</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ==================== ATRIBUTOS ==================== -->
                <div class="sys-panel" id="panel-attributes">
                    <div class="sys-editor-content-header">
                        <div>
                            <h2><i class="fas fa-fist-raised"></i> Atributos</h2>
                            <p>Configure os atributos base do personagem</p>
                        </div>
                    </div>
                    <div class="sys-editor-content-body">
                        <div class="sys-form-section">
                            <h3><i class="fas fa-list"></i> Tipo de Atributos</h3>
                            <div class="sys-form-group">
                                <label>Preset de Atributos</label>
                                <select id="sysAttrPreset" onchange="SystemEditor.onAttrPresetChange()">
                                    <option value="realsscripts">Realms&Scripts (FOR, CON, VON, CAR, INT, AGI)</option>
                                    <option value="dnd">D&D 5e (FOR, DES, CON, INT, SAB, CAR)</option>
                                    <option value="custom">Personalizado</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="sys-form-section hidden" id="sysCustomAttrsSection">
                            <h3><i class="fas fa-edit"></i> Atributos Personalizados</h3>
                            <p style="color: var(--text-muted); margin-bottom: 1rem;">Defina os atributos do seu sistema. Cada atributo precisa de nome, abrevia√ß√£o (3 letras) e valor padr√£o.</p>
                            <div class="sys-list-container" id="sysAttrsList">
                                <!-- Rendered by JS -->
                            </div>
                            <button class="sys-add-item-btn" onclick="SystemEditor.addAttribute()">
                                <i class="fas fa-plus"></i> Adicionar Atributo
                            </button>
                        </div>
                        
                        <div class="sys-form-section">
                            <h3><i class="fas fa-calculator"></i> C√°lculo de Modificadores</h3>
                            <div class="sys-form-grid">
                                <div class="sys-form-group">
                                    <label>F√≥rmula de Modificador</label>
                                    <select id="sysModifierCalc">
                                        <option value="direct">Direto (valor = modificador)</option>
                                        <option value="dnd">D&D ((valor - 10) / 2)</option>
                                        <option value="half">Metade (valor / 2)</option>
                                        <option value="minus5">Subtra√ß√£o (valor - 5)</option>
                                        <option value="custom">Personalizado</option>
                                    </select>
                                </div>
                                <div class="sys-form-group">
                                    <label>Valor M√≠nimo</label>
                                    <input type="number" id="sysAttrMin" value="1" min="0">
                                </div>
                                <div class="sys-form-group">
                                    <label>Valor M√°ximo</label>
                                    <input type="number" id="sysAttrMax" value="20" min="1">
                                </div>
                                <div class="sys-form-group">
                                    <label>Limite de Pontos (0 = ilimitado)</label>
                                    <input type="number" id="sysAttrPointLimit" value="0" min="0">
                                </div>
                            </div>
                            
                            <div id="sysCustomModSection" class="hidden">
                                <h4>F√≥rmula Personalizada</h4>
                                <div class="sys-formula-builder">
                                    <input type="text" id="sysCustomModFormula" class="sys-formula-input" placeholder="Ex: Math.floor((value - 10) / 2)">
                                    <div class="sys-formula-vars">
                                        <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysCustomModFormula', 'value')">value</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Formula Reference -->
                        <div class="sys-form-section">
                            <h3><i class="fas fa-info-circle"></i> Refer√™ncia de Vari√°veis para F√≥rmulas</h3>
                            <p style="color: var(--text-muted); margin-bottom: 1rem;">
                                Clique em uma vari√°vel para copiar seu nome. Use estas em f√≥rmulas personalizadas.
                            </p>
                            <div class="sys-formula-vars" style="background: var(--bg-main); padding: 1rem; border-radius: 6px;">
                                <strong style="width: 100%; display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">Atributos Base:</strong>
                                <span class="sys-formula-var" title="For√ßa" onclick="SystemEditor.copyVar('for')">for</span>
                                <span class="sys-formula-var" title="Constitui√ß√£o" onclick="SystemEditor.copyVar('con')">con</span>
                                <span class="sys-formula-var" title="Vontade (R&S)" onclick="SystemEditor.copyVar('von')">von</span>
                                <span class="sys-formula-var" title="Carisma" onclick="SystemEditor.copyVar('cha')">car / cha</span>
                                <span class="sys-formula-var" title="Intelig√™ncia" onclick="SystemEditor.copyVar('int')">int</span>
                                <span class="sys-formula-var" title="Agilidade (R&S)" onclick="SystemEditor.copyVar('agi')">agi</span>
                                <span class="sys-formula-var" title="Destreza (D&D)" onclick="SystemEditor.copyVar('dex')">des / dex</span>
                                <span class="sys-formula-var" title="Sabedoria (D&D)" onclick="SystemEditor.copyVar('wis')">sab / wis</span>
                            </div>
                            <div class="sys-formula-vars" style="background: var(--bg-main); padding: 1rem; border-radius: 6px; margin-top: 0.5rem;">
                                <strong style="width: 100%; display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">Modificadores:</strong>
                                <span class="sys-formula-var" title="Modificador de For√ßa" onclick="SystemEditor.copyVar('forMod')">forMod</span>
                                <span class="sys-formula-var" title="Modificador de Constitui√ß√£o" onclick="SystemEditor.copyVar('conMod')">conMod</span>
                                <span class="sys-formula-var" title="Modificador de Vontade" onclick="SystemEditor.copyVar('vonMod')">vonMod</span>
                                <span class="sys-formula-var" title="Modificador de Carisma" onclick="SystemEditor.copyVar('chaMod')">chaMod</span>
                                <span class="sys-formula-var" title="Modificador de Intelig√™ncia" onclick="SystemEditor.copyVar('intMod')">intMod</span>
                                <span class="sys-formula-var" title="Modificador de Agilidade" onclick="SystemEditor.copyVar('agiMod')">agiMod</span>
                                <span class="sys-formula-var" title="Modificador de Destreza" onclick="SystemEditor.copyVar('dexMod')">desMod / dexMod</span>
                                <span class="sys-formula-var" title="Modificador de Sabedoria" onclick="SystemEditor.copyVar('wisMod')">sabMod / wisMod</span>
                            </div>
                            <div class="sys-formula-vars" style="background: var(--bg-main); padding: 1rem; border-radius: 6px; margin-top: 0.5rem;">
                                <strong style="width: 100%; display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">Personagem:</strong>
                                <span class="sys-formula-var" title="N√≠vel do personagem" onclick="SystemEditor.copyVar('level')">level</span>
                                <span class="sys-formula-var" title="B√¥nus de profici√™ncia" onclick="SystemEditor.copyVar('profBonus')">profBonus</span>
                                <span class="sys-formula-var" title="Dado de vida da classe" onclick="SystemEditor.copyVar('hitDie')">hitDie</span>
                                <span class="sys-formula-var" title="HP m√°ximo" onclick="SystemEditor.copyVar('maxHP')">maxHP</span>
                                <span class="sys-formula-var" title="PE m√°ximo" onclick="SystemEditor.copyVar('maxPE')">maxPE</span>
                            </div>
                            <div class="sys-formula-vars" style="background: var(--bg-main); padding: 1rem; border-radius: 6px; margin-top: 0.5rem;">
                                <strong style="width: 100%; display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">Fus√µes (Realms&Scripts):</strong>
                                <span class="sys-formula-var" title="N√≠vel de fus√£o do cora√ß√£o" onclick="SystemEditor.copyVar('fusaoCoracao')">fusaoCoracao</span>
                                <span class="sys-formula-var" title="N√≠vel de fus√£o do c√©rebro" onclick="SystemEditor.copyVar('fusaoCerebro')">fusaoCerebro</span>
                                <span class="sys-formula-var" title="N√≠vel de fus√£o dos olhos" onclick="SystemEditor.copyVar('fusaoOlhos')">fusaoOlhos</span>
                                <span class="sys-formula-var" title="N√≠vel de fus√£o do bra√ßo" onclick="SystemEditor.copyVar('fusaoBraco')">fusaoBraco</span>
                                <span class="sys-formula-var" title="N√≠vel de fus√£o do osso" onclick="SystemEditor.copyVar('fusaoOsso')">fusaoOsso</span>
                                <span class="sys-formula-var" title="N√≠vel de fus√£o do m√∫sculo" onclick="SystemEditor.copyVar('fusaoMusculo')">fusaoMusculo</span>
                                <span class="sys-formula-var" title="N√≠vel de fus√£o da perna" onclick="SystemEditor.copyVar('fusaoPerna')">fusaoPerna</span>
                            </div>
                            <div class="sys-formula-vars" style="background: var(--bg-main); padding: 1rem; border-radius: 6px; margin-top: 0.5rem;">
                                <strong style="width: 100%; display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">Combate:</strong>
                                <span class="sys-formula-var" title="Classe de Armadura base" onclick="SystemEditor.copyVar('baseAC')">baseAC</span>
                                <span class="sys-formula-var" title="Classe de Armadura total" onclick="SystemEditor.copyVar('ac')">ca / ac</span>
                                <span class="sys-formula-var" title="B√¥nus de armadura" onclick="SystemEditor.copyVar('armorBonus')">armorBonus</span>
                                <span class="sys-formula-var" title="B√¥nus de escudo" onclick="SystemEditor.copyVar('shieldBonus')">shieldBonus</span>
                                <span class="sys-formula-var" title="B√¥nus de esquiva" onclick="SystemEditor.copyVar('dodgeBonus')">dodgeBonus</span>
                                <span class="sys-formula-var" title="B√¥nus de reflexos" onclick="SystemEditor.copyVar('reflexos')">reflexos</span>
                                <span class="sys-formula-var" title="B√¥nus de per√≠cia" onclick="SystemEditor.copyVar('skillBonus')">skillBonus</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ==================== RECURSOS ==================== -->
                <div class="sys-panel" id="panel-resources">
                    <div class="sys-editor-content-header">
                        <div>
                            <h2><i class="fas fa-heart"></i> Recursos</h2>
                            <p>HP, PE, Sanidade, Pontos de A√ß√£o</p>
                        </div>
                    </div>
                    <div class="sys-editor-content-body">
                        <!-- Tabs for Resources -->
                        <div class="sys-panel-tabs">
                            <button class="sys-panel-tab active" data-restab="hp">Pontos de Vida</button>
                            <button class="sys-panel-tab" data-restab="pe">Pontos de Energia</button>
                            <button class="sys-panel-tab" data-restab="sanity">Sanidade</button>
                            <button class="sys-panel-tab" data-restab="pa">Pontos de A√ß√£o</button>
                        </div>
                        
                        <!-- HP Tab -->
                        <div class="sys-panel-tab-content active" id="restab-hp">
                            <div class="sys-form-section">
                                <h3><i class="fas fa-heart"></i> Pontos de Vida (HP)</h3>
                                <div class="sys-form-group">
                                    <label>F√≥rmula de HP M√°ximo</label>
                                    <select id="sysHpFormula">
                                        <option value="realsscripts">Realms&Scripts: (Cora√ß√£o √ó 20) + (N√≠vel √ó CON)</option>
                                        <option value="dnd">D&D: Dado de Vida + mod. CON por n√≠vel</option>
                                        <option value="levelcon">N√≠vel √ó CON</option>
                                        <option value="levelonly">Apenas N√≠vel √ó Multiplicador</option>
                                        <option value="flat">Fixo por N√≠vel</option>
                                        <option value="custom">Personalizado</option>
                                    </select>
                                </div>
                                
                                <div id="sysHpCustom" class="hidden">
                                    <div class="sys-formula-builder">
                                        <input type="text" id="sysHpCustomFormula" class="sys-formula-input" placeholder="Ex: (level * 10) + (con * 2)">
                                        <div class="sys-formula-vars">
                                            <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysHpCustomFormula', 'level')">level</span>
                                            <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysHpCustomFormula', 'hitDie')">hitDie</span>
                                            <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysHpCustomFormula', 'con')">con</span>
                                            <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysHpCustomFormula', 'conMod')">conMod</span>
                                            <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysHpCustomFormula', 'for')">for</span>
                                            <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysHpCustomFormula', 'forMod')">forMod</span>
                                            <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysHpCustomFormula', 'fusaoCoracao')">fusaoCoracao</span>
                                            <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysHpCustomFormula', 'profBonus')">profBonus</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="sysHpFlat" class="hidden">
                                    <div class="sys-form-row">
                                        <div class="sys-form-group">
                                            <label>HP Base (N√≠vel 1)</label>
                                            <input type="number" id="sysHpBase" value="10" min="1">
                                        </div>
                                        <div class="sys-form-group">
                                            <label>HP por N√≠vel</label>
                                            <input type="number" id="sysHpPerLevel" value="5" min="0">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- PE Tab -->
                        <div class="sys-panel-tab-content" id="restab-pe">
                            <div class="sys-form-section">
                                <h3><i class="fas fa-bolt"></i> Pontos de Energia</h3>
                                <div class="sys-toggle-row">
                                    <div class="sys-toggle-info">
                                        <span>Possui Pontos de Energia</span>
                                        <small>Mana, Ki, Foco, etc.</small>
                                    </div>
                                    <label class="sys-toggle">
                                        <input type="checkbox" id="sysHasPE" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                
                                <div id="sysPEConfig">
                                    <div class="sys-form-row">
                                        <div class="sys-form-group">
                                            <label>Nome dos Pontos</label>
                                            <input type="text" id="sysPEName" value="PE" placeholder="PE, Mana, Ki...">
                                        </div>
                                        <div class="sys-form-group">
                                            <label>F√≥rmula</label>
                                            <select id="sysPEFormula">
                                                <option value="realsscripts">Realms&Scripts: (C√©rebro √ó 6) + (N√≠vel √ó VON)</option>
                                                <option value="simple">N√≠vel √ó Multiplicador</option>
                                                <option value="attr">Baseado em Atributo</option>
                                                <option value="custom">Personalizado</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div id="sysPECustom" class="hidden">
                                        <div class="sys-formula-builder">
                                            <input type="text" id="sysPECustomFormula" class="sys-formula-input" placeholder="Ex: (level * 5) + (int * 2)">
                                            <div class="sys-formula-vars">
                                                <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysPECustomFormula', 'level')">level</span>
                                                <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysPECustomFormula', 'int')">int</span>
                                                <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysPECustomFormula', 'intMod')">intMod</span>
                                                <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysPECustomFormula', 'wis')">wis</span>
                                                <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysPECustomFormula', 'wisMod')">wisMod</span>
                                                <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysPECustomFormula', 'von')">von</span>
                                                <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysPECustomFormula', 'vonMod')">vonMod</span>
                                                <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysPECustomFormula', 'cha')">cha</span>
                                                <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysPECustomFormula', 'chaMod')">chaMod</span>
                                                <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysPECustomFormula', 'fusaoCerebro')">fusaoCerebro</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Sanity Tab -->
                        <div class="sys-panel-tab-content" id="restab-sanity">
                            <div class="sys-form-section">
                                <h3><i class="fas fa-brain"></i> Sanidade</h3>
                                <div class="sys-toggle-row">
                                    <div class="sys-toggle-info">
                                        <span>Possui Sanidade</span>
                                        <small>Stress, Corrup√ß√£o, etc.</small>
                                    </div>
                                    <label class="sys-toggle">
                                        <input type="checkbox" id="sysHasSanity" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                
                                <div id="sysSanityConfig">
                                    <div class="sys-form-group">
                                        <label>Nome do Recurso</label>
                                        <input type="text" id="sysSanityName" value="Sanidade" placeholder="Sanidade, Stress...">
                                    </div>
                                    
                                    <div class="sys-toggle-row">
                                        <div class="sys-toggle-info">
                                            <span>Possui Valor M√°ximo</span>
                                            <small>Se desligado, apenas tracking manual</small>
                                        </div>
                                        <label class="sys-toggle">
                                            <input type="checkbox" id="sysSanityHasMax">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    
                                    <div id="sysSanityMaxConfig" class="hidden">
                                        <div class="sys-form-group">
                                            <label>F√≥rmula de M√°ximo</label>
                                            <select id="sysSanityFormula">
                                                <option value="flat">Valor Fixo</option>
                                                <option value="attr">Atributo √ó Multiplicador</option>
                                                <option value="custom">Personalizado</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- PA Tab -->
                        <div class="sys-panel-tab-content" id="restab-pa">
                            <div class="sys-form-section">
                                <h3><i class="fas fa-running"></i> Pontos de A√ß√£o</h3>
                                <div class="sys-toggle-row">
                                    <div class="sys-toggle-info">
                                        <span>Possui Pontos de A√ß√£o</span>
                                        <small>Sistema de economia de a√ß√µes por turno</small>
                                    </div>
                                    <label class="sys-toggle">
                                        <input type="checkbox" id="sysHasPA">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                
                                <div id="sysPAConfig" class="hidden">
                                    <div class="sys-form-row">
                                        <div class="sys-form-group">
                                            <label>Nome dos Pontos</label>
                                            <input type="text" id="sysPAName" value="PA" placeholder="PA, A√ß√µes...">
                                        </div>
                                        <div class="sys-form-group">
                                            <label>F√≥rmula</label>
                                            <select id="sysPAFormula">
                                                <option value="realsscripts">Realms&Scripts: AGI + N√≠vel + 4</option>
                                                <option value="flat">Valor Fixo</option>
                                                <option value="attr">Baseado em Atributo</option>
                                                <option value="custom">Personalizado</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div id="sysPACustom" class="hidden">
                                        <div class="sys-formula-builder">
                                            <input type="text" id="sysPACustomFormula" class="sys-formula-input" placeholder="Ex: agiMod + level + 4">
                                            <div class="sys-formula-vars">
                                                <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysPACustomFormula', 'agiMod')">agiMod</span>
                                                <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysPACustomFormula', 'desMod')">desMod</span>
                                                <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysPACustomFormula', 'level')">level</span>
                                                <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysPACustomFormula', 'profBonus')">profBonus</span>
                                                <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysPACustomFormula', '4')">4</span>
                                                <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysPACustomFormula', '3')">3</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ==================== CLASSES ==================== -->
                <div class="sys-panel" id="panel-classes">
                    <div class="sys-editor-content-header">
                        <div>
                            <h2><i class="fas fa-hat-wizard"></i> Classes</h2>
                            <p>Configure as classes do sistema</p>
                        </div>
                        <div class="sys-editor-header-actions">
                            <button class="btn-primary" onclick="SystemEditor.addClass()">
                                <i class="fas fa-plus"></i> Nova Classe
                            </button>
                        </div>
                    </div>
                    <div class="sys-editor-content-body">
                        <div class="sys-form-section">
                            <h3><i class="fas fa-cog"></i> Configura√ß√£o</h3>
                            <div class="sys-toggle-row">
                                <div class="sys-toggle-info">
                                    <span>Sistema usa Classes</span>
                                    <small>Personagens escolhem uma classe com habilidades</small>
                                </div>
                                <label class="sys-toggle">
                                    <input type="checkbox" id="sysHasClasses">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            
                            <div id="sysClassesConfig" class="hidden">
                                <div class="sys-toggle-row">
                                    <div class="sys-toggle-info">
                                        <span>Classe afeta HP</span>
                                        <small>Dado de vida diferente por classe</small>
                                    </div>
                                    <label class="sys-toggle">
                                        <input type="checkbox" id="sysClassAffectsHP" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                
                                <div class="sys-toggle-row">
                                    <div class="sys-toggle-info">
                                        <span>Multiclasse permitido</span>
                                        <small>Personagens podem ter m√∫ltiplas classes</small>
                                    </div>
                                    <label class="sys-toggle">
                                        <input type="checkbox" id="sysAllowMulticlass">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="sys-form-section" id="sysClassesListSection">
                            <h3><i class="fas fa-list"></i> Lista de Classes</h3>
                            <div class="sys-table-editor">
                                <table class="sys-table" id="sysClassesTable">
                                    <thead>
                                        <tr>
                                            <th>Nome</th>
                                            <th>Dado Vida</th>
                                            <th>Atrib. Principal</th>
                                            <th>Conjurador</th>
                                            <th class="actions-cell">A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="sysClassesTableBody">
                                        <!-- Rendered by JS -->
                                    </tbody>
                                </table>
                            </div>
                            <button class="sys-add-item-btn" onclick="SystemEditor.addClass()">
                                <i class="fas fa-plus"></i> Adicionar Classe
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- ==================== RA√áAS ==================== -->
                <div class="sys-panel" id="panel-races">
                    <div class="sys-editor-content-header">
                        <div>
                            <h2><i class="fas fa-users"></i> Ra√ßas</h2>
                            <p>Configure as ra√ßas dispon√≠veis</p>
                        </div>
                        <div class="sys-editor-header-actions">
                            <button class="btn-primary" onclick="SystemEditor.addRace()">
                                <i class="fas fa-plus"></i> Nova Ra√ßa
                            </button>
                        </div>
                    </div>
                    <div class="sys-editor-content-body">
                        <div class="sys-form-section">
                            <h3><i class="fas fa-cog"></i> Configura√ß√£o</h3>
                            <div class="sys-toggle-row">
                                <div class="sys-toggle-info">
                                    <span>Sistema usa Ra√ßas</span>
                                    <small>Personagens escolhem uma ra√ßa com b√¥nus</small>
                                </div>
                                <label class="sys-toggle">
                                    <input type="checkbox" id="sysHasRaces" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            
                            <div id="sysRacesConfig">
                                <div class="sys-form-group">
                                    <label>Preset de Ra√ßas</label>
                                    <select id="sysRacePreset" onchange="SystemEditor.onRacePresetChange()">
                                        <option value="none">Nenhum (criar do zero)</option>
                                        <option value="realsscripts">Realms&Scripts (Humano, Elfo, An√£o...)</option>
                                        <option value="dnd">D&D 5e (27 ra√ßas)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="sys-form-section">
                            <h3><i class="fas fa-list"></i> Lista de Ra√ßas</h3>
                            <div class="sys-table-editor">
                                <table class="sys-table" id="sysRacesTable">
                                    <thead>
                                        <tr>
                                            <th>Nome</th>
                                            <th>B√¥nus de Atributos</th>
                                            <th>Habilidades</th>
                                            <th class="actions-cell">A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="sysRacesTableBody">
                                        <!-- Rendered by JS -->
                                    </tbody>
                                </table>
                            </div>
                            <button class="sys-add-item-btn" onclick="SystemEditor.addRace()">
                                <i class="fas fa-plus"></i> Adicionar Ra√ßa
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- ==================== PER√çCIAS ==================== -->
                <div class="sys-panel" id="panel-skills">
                    <div class="sys-editor-content-header">
                        <div>
                            <h2><i class="fas fa-book-open"></i> Per√≠cias</h2>
                            <p>Configure o sistema de per√≠cias</p>
                        </div>
                        <div class="sys-editor-header-actions">
                            <button class="btn-primary" onclick="SystemEditor.addSkill()">
                                <i class="fas fa-plus"></i> Nova Per√≠cia
                            </button>
                        </div>
                    </div>
                    <div class="sys-editor-content-body">
                        <div class="sys-form-section">
                            <h3><i class="fas fa-cog"></i> Tipo de Sistema</h3>
                            <div class="sys-form-row">
                                <div class="sys-form-group">
                                    <label>Sistema de Per√≠cias</label>
                                    <select id="sysSkillSystem">
                                        <option value="realsscripts">Realms&Scripts (Treino 0-3)</option>
                                        <option value="dnd">D&D (Profici√™ncia/Expertise)</option>
                                        <option value="ranks">Ranks (pontos por n√≠vel)</option>
                                        <option value="percent">Percentual (0-100%)</option>
                                    </select>
                                </div>
                                <div class="sys-form-group">
                                    <label>Preset de Per√≠cias</label>
                                    <select id="sysSkillPreset" onchange="SystemEditor.onSkillPresetChange()">
                                        <option value="none">Nenhum (criar do zero)</option>
                                        <option value="realsscripts">Realms&Scripts (36 per√≠cias)</option>
                                        <option value="dnd">D&D 5e (18 per√≠cias)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="sys-form-section">
                            <h3><i class="fas fa-list"></i> Lista de Per√≠cias</h3>
                            <div class="sys-table-editor">
                                <table class="sys-table" id="sysSkillsTable">
                                    <thead>
                                        <tr>
                                            <th>Nome</th>
                                            <th>Atributo</th>
                                            <th>Penalidade Armadura</th>
                                            <th class="actions-cell">A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="sysSkillsTableBody">
                                        <!-- Rendered by JS -->
                                    </tbody>
                                </table>
                            </div>
                            <button class="sys-add-item-btn" onclick="SystemEditor.addSkill()">
                                <i class="fas fa-plus"></i> Adicionar Per√≠cia
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- ==================== COMBATE ==================== -->
                <div class="sys-panel" id="panel-combat">
                    <div class="sys-editor-content-header">
                        <div>
                            <h2><i class="fas fa-shield-alt"></i> Combate</h2>
                            <p>Configure as regras de combate</p>
                        </div>
                    </div>
                    <div class="sys-editor-content-body">
                        <!-- Combat Tabs -->
                        <div class="sys-panel-tabs">
                            <button class="sys-panel-tab active" data-combtab="defense">Defesas</button>
                            <button class="sys-panel-tab" data-combtab="initiative">Iniciativa</button>
                            <button class="sys-panel-tab" data-combtab="saves">Resist√™ncias</button>
                            <button class="sys-panel-tab" data-combtab="fusions">Fus√µes</button>
                        </div>
                        
                        <!-- Defense Tab -->
                        <div class="sys-panel-tab-content active" id="combtab-defense">
                            <div class="sys-form-section">
                                <h3><i class="fas fa-shield-alt"></i> Classe de Armadura (CA)</h3>
                                <div class="sys-form-group">
                                    <label>F√≥rmula de CA</label>
                                    <select id="sysCAFormula">
                                        <option value="realsscripts">Realms&Scripts: 10 + B√¥nus Armadura</option>
                                        <option value="dnd">D&D: 10 + mod. DES + Armadura</option>
                                        <option value="flatbase">Base Fixa + Atributo</option>
                                        <option value="custom">Personalizado</option>
                                    </select>
                                </div>
                                
                                <div id="sysCACustom" class="hidden">
                                    <div class="sys-formula-builder">
                                        <input type="text" id="sysCACustomFormula" class="sys-formula-input" placeholder="Ex: 10 + desMod + armorBonus">
                                        <div class="sys-formula-vars">
                                            <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysCACustomFormula', '10')">10</span>
                                            <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysCACustomFormula', 'desMod')">desMod</span>
                                            <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysCACustomFormula', 'agiMod')">agiMod</span>
                                            <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysCACustomFormula', 'conMod')">conMod</span>
                                            <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysCACustomFormula', 'armorBonus')">armorBonus</span>
                                            <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysCACustomFormula', 'shieldBonus')">shieldBonus</span>
                                            <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysCACustomFormula', 'level')">level</span>
                                            <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysCACustomFormula', 'profBonus')">profBonus</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="sys-form-section">
                                <h3><i class="fas fa-running"></i> Esquiva</h3>
                                <div class="sys-toggle-row">
                                    <div class="sys-toggle-info">
                                        <span>Possui Esquiva Separada</span>
                                        <small>Valor de defesa alternativo</small>
                                    </div>
                                    <label class="sys-toggle">
                                        <input type="checkbox" id="sysHasDodge">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                
                                <div id="sysDodgeConfig" class="hidden">
                                    <div class="sys-form-group">
                                        <label>F√≥rmula de Esquiva</label>
                                        <select id="sysDodgeFormula">
                                            <option value="realsscripts">Realms&Scripts: CA + Reflexos</option>
                                            <option value="dexbased">10 + mod. DES</option>
                                            <option value="custom">Personalizado</option>
                                        </select>
                                    </div>
                                    
                                    <div id="sysDodgeCustom" class="hidden">
                                        <div class="sys-formula-builder">
                                            <input type="text" id="sysDodgeCustomFormula" class="sys-formula-input" placeholder="Ex: ca + reflexos">
                                            <div class="sys-formula-vars">
                                                <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysDodgeCustomFormula', 'ca')">ca</span>
                                                <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysDodgeCustomFormula', 'reflexos')">reflexos</span>
                                                <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysDodgeCustomFormula', 'desMod')">desMod</span>
                                                <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysDodgeCustomFormula', 'agiMod')">agiMod</span>
                                                <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysDodgeCustomFormula', '10')">10</span>
                                                <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysDodgeCustomFormula', 'level')">level</span>
                                                <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysDodgeCustomFormula', 'armorBonus')">armorBonus</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Initiative Tab -->
                        <div class="sys-panel-tab-content" id="combtab-initiative">
                            <div class="sys-form-section">
                                <h3><i class="fas fa-bolt"></i> Iniciativa</h3>
                                <div class="sys-form-group">
                                    <label>F√≥rmula de Iniciativa</label>
                                    <select id="sysInitFormula">
                                        <option value="dex">D&D: mod. DES</option>
                                        <option value="agi">Realms&Scripts: AGI</option>
                                        <option value="skill">Baseado em Per√≠cia</option>
                                        <option value="custom">Personalizado</option>
                                    </select>
                                </div>
                                
                                <div id="sysInitCustom" class="hidden">
                                    <div class="sys-formula-builder">
                                        <input type="text" id="sysInitCustomFormula" class="sys-formula-input" placeholder="Ex: desMod + nivel">
                                        <div class="sys-formula-vars">
                                            <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysInitCustomFormula', 'desMod')">desMod</span>
                                            <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysInitCustomFormula', 'agiMod')">agiMod</span>
                                            <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysInitCustomFormula', 'intMod')">intMod</span>
                                            <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysInitCustomFormula', 'level')">level</span>
                                            <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysInitCustomFormula', 'profBonus')">profBonus</span>
                                            <span class="sys-formula-var" onclick="SystemEditor.insertVar('sysInitCustomFormula', 'skillBonus')">skillBonus</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Saving Throws Tab -->
                        <div class="sys-panel-tab-content" id="combtab-saves">
                            <div class="sys-form-section">
                                <h3><i class="fas fa-shield-virus"></i> Testes de Resist√™ncia</h3>
                                <div class="sys-toggle-row">
                                    <div class="sys-toggle-info">
                                        <span>Possui Testes de Resist√™ncia</span>
                                        <small>Saving Throws, Fortitude/Reflexos/Vontade</small>
                                    </div>
                                    <label class="sys-toggle">
                                        <input type="checkbox" id="sysHasSaves">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                
                                <div id="sysSavesConfig" class="hidden">
                                    <div class="sys-form-group">
                                        <label>Tipo de Resist√™ncia</label>
                                        <select id="sysSaveType">
                                            <option value="dnd">D&D: 6 atributos com profici√™ncia</option>
                                            <option value="three">3 Tipos: Fort, Ref, Von</option>
                                            <option value="custom">Personalizado</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Fusions Tab -->
                        <div class="sys-panel-tab-content" id="combtab-fusions">
                            <div class="sys-form-section">
                                <h3><i class="fas fa-dna"></i> Fus√µes</h3>
                                <div class="sys-toggle-row">
                                    <div class="sys-toggle-info">
                                        <span>Sistema possui Fus√µes</span>
                                        <small>√ìrg√£os, Ossos, M√∫sculos - √∫nico do Realms&Scripts</small>
                                    </div>
                                    <label class="sys-toggle">
                                        <input type="checkbox" id="sysHasFusions">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                
                                <div id="sysFusionsConfig" class="hidden">
                                    <div class="sys-form-group">
                                        <label>Tipos de Fus√£o (uma por linha: Nome, Descri√ß√£o)</label>
                                        <textarea id="sysFusionTypes" placeholder="Cora√ß√£o, Aumenta HP&#10;C√©rebro, Aumenta PE&#10;Olhos, Melhora Percep√ß√£o"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ==================== MAGIAS ==================== -->
                <div class="sys-panel" id="panel-magic">
                    <div class="sys-editor-content-header">
                        <div>
                            <h2><i class="fas fa-magic"></i> Magias</h2>
                            <p>Configure o sistema de magias</p>
                        </div>
                    </div>
                    <div class="sys-editor-content-body">
                        <div class="sys-form-section">
                            <h3><i class="fas fa-cog"></i> Configura√ß√£o</h3>
                            <div class="sys-toggle-row">
                                <div class="sys-toggle-info">
                                    <span>Sistema possui Magias</span>
                                    <small>Espa√ßos de magia, spell slots, etc.</small>
                                </div>
                                <label class="sys-toggle">
                                    <input type="checkbox" id="sysHasMagic">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            
                            <div id="sysMagicConfig" class="hidden">
                                <div class="sys-form-group">
                                    <label>Sistema de Magia</label>
                                    <select id="sysMagicSystem">
                                        <option value="dnd">D&D: Spell Slots por n√≠vel</option>
                                        <option value="mana">Mana/PE: Custo por magia</option>
                                        <option value="daily">Di√°rio: X usos por dia</option>
                                        <option value="custom">Personalizado</option>
                                    </select>
                                </div>
                                
                                <div class="sys-toggle-row">
                                    <div class="sys-toggle-info">
                                        <span>Possui Cantrips/Truques</span>
                                        <small>Magias de n√≠vel 0 ilimitadas</small>
                                    </div>
                                    <label class="sys-toggle">
                                        <input type="checkbox" id="sysHasCantrips" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                
                                <div class="sys-form-row">
                                    <div class="sys-form-group">
                                        <label>Atributo de Conjura√ß√£o Padr√£o</label>
                                        <select id="sysSpellAttr">
                                            <option value="int">INT (Intelig√™ncia)</option>
                                            <option value="wis">SAB (Sabedoria)</option>
                                            <option value="cha">CAR (Carisma)</option>
                                            <option value="class">Baseado na Classe</option>
                                        </select>
                                    </div>
                                    <div class="sys-form-group">
                                        <label>N√≠vel M√°ximo de Magia</label>
                                        <input type="number" id="sysMaxSpellLevel" value="9" min="1" max="20">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ==================== CAMPOS ==================== -->
                <div class="sys-panel" id="panel-fields">
                    <div class="sys-editor-content-header">
                        <div>
                            <h2><i class="fas fa-th-list"></i> Campos da Ficha</h2>
                            <p>Configure quais campos aparecem na ficha</p>
                        </div>
                    </div>
                    <div class="sys-editor-content-body">
                        <div class="sys-form-section">
                            <h3><i class="fas fa-check-square"></i> Campos Vis√≠veis</h3>
                            
                            <h4>Informa√ß√µes B√°sicas</h4>
                            <div class="sys-toggle-row">
                                <div class="sys-toggle-info"><span>Nome do Personagem</span></div>
                                <label class="sys-toggle"><input type="checkbox" checked disabled><span class="slider"></span></label>
                            </div>
                            <div class="sys-toggle-row">
                                <div class="sys-toggle-info"><span>N√≠vel</span></div>
                                <label class="sys-toggle"><input type="checkbox" checked disabled><span class="slider"></span></label>
                            </div>
                            <div class="sys-toggle-row">
                                <div class="sys-toggle-info"><span>Ra√ßa</span></div>
                                <label class="sys-toggle"><input type="checkbox" id="sysFieldRace" checked><span class="slider"></span></label>
                            </div>
                            <div class="sys-toggle-row">
                                <div class="sys-toggle-info"><span>Classe</span></div>
                                <label class="sys-toggle"><input type="checkbox" id="sysFieldClass"><span class="slider"></span></label>
                            </div>
                            <div class="sys-toggle-row">
                                <div class="sys-toggle-info"><span>Background/Hist√≥ria</span></div>
                                <label class="sys-toggle"><input type="checkbox" id="sysFieldBackground" checked><span class="slider"></span></label>
                            </div>
                            
                            <h4>Combate</h4>
                            <div class="sys-toggle-row">
                                <div class="sys-toggle-info"><span>Invent√°rio com Peso</span></div>
                                <label class="sys-toggle"><input type="checkbox" id="sysFieldWeight" checked><span class="slider"></span></label>
                            </div>
                            <div class="sys-toggle-row">
                                <div class="sys-toggle-info"><span>Ataques</span></div>
                                <label class="sys-toggle"><input type="checkbox" id="sysFieldAttacks" checked><span class="slider"></span></label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ==================== F√ìRMULAS ==================== -->
            </main>
        </div>
    </div>
    
    <!-- Delete Confirmation Dialog -->
    <div class="sys-dialog-overlay" id="sysDeleteDialog">
        <div class="sys-dialog">
            <h3>Excluir Sistema?</h3>
            <p>Esta a√ß√£o n√£o pode ser desfeita. Todas as configura√ß√µes ser√£o perdidas.</p>
            <div class="sys-dialog-buttons">
                <button class="btn-secondary" onclick="SystemEditor.cancelDelete()">Cancelar</button>
                <button class="btn-danger" onclick="SystemEditor.doDelete()">Excluir</button>
            </div>
        </div>
    </div>
    <!-- #endregion SYSTEM EDITOR FULL-SCREEN -->

    <!-- Scripts - Ordem importante! -->
    <!-- Firebase -->
    <script src="js/firebase-config.js"></script>
    
    <!-- Core - Sistema Modular -->
    <script src="js/core/system-registry.js"></script>
    
    <!-- Sistemas Base -->
    <script src="js/systems/dnd5e/index.js"></script>
    <script src="js/systems/ordemparanormal/index.js"></script>
    <script src="js/systems/realsscripts/index.js"></script>
    
    <!-- C√°lculos e Compatibilidade -->
    <script src="js/core/calculations-base.js"></script>
    <script src="js/core/calculations-compat.js"></script>
    <script src="js/core/systems-api.js"></script>
    
    <!-- APIs e Funcionalidades -->
    <script src="js/api.js?v=3"></script>
    <script src="js/auth.js"></script>
    
    <!-- Editor de Sistemas -->
    <script src="js/editor/system-manager.js?v=2"></script>
    <script src="js/editor/system-editor.js?v=3"></script>
    
    <!-- Ficha e UI -->
    <script src="js/sheet.js?v=4"></script>
    <script src="js/layout.js"></script>
    <script src="js/app.js?v=2"></script>
</body>